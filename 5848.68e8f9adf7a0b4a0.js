"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5848],{5848:(A,f,s)=>{s.r(f),s.d(f,{ProductoPageModule:()=>w});var p=s(2881),P=s(4341),a=s(3092),_=s(5207),g=s(467),u=s(7643),m=s(5312),n=s(1360),h=s(7664),C=s(5844),x=s(5032);function M(e,c){1&e&&(n.j41(0,"div",38),n.nrm(1,"ion-icon",39),n.j41(2,"p",40),n.EFF(3,"Imagen no disponible"),n.k0s()())}function v(e,c){1&e&&(n.j41(0,"div",41),n.nrm(1,"ion-spinner",42),n.j41(2,"p",43),n.EFF(3,"Cargando imagen..."),n.k0s()())}function O(e,c){if(1&e&&(n.j41(0,"div",20),n.nrm(1,"ion-icon",44),n.j41(2,"div",22)(3,"span",23),n.EFF(4,"Descripci\xf3n"),n.k0s(),n.j41(5,"span",45),n.EFF(6),n.k0s()()()),2&e){const i=n.XpG(2);n.R7$(6),n.JRh(i.producto.descripcion)}}function b(e,c){if(1&e&&(n.j41(0,"div",20),n.nrm(1,"ion-icon",46),n.j41(2,"div",22)(3,"span",23),n.EFF(4,"Informaci\xf3n adicional"),n.k0s(),n.j41(5,"span",24),n.EFF(6),n.k0s()()()),2&e){const i=n.XpG(2);n.R7$(6),n.JRh(i.producto.infoExtra)}}function j(e,c){1&e&&(n.j41(0,"div",47)(1,"ion-chip",48),n.nrm(2,"ion-icon",49),n.j41(3,"ion-label"),n.EFF(4,"Este es tu producto"),n.k0s()()())}function k(e,c){if(1&e){const i=n.RV6();n.qex(0),n.j41(1,"section",8)(2,"div",9)(3,"img",10),n.bIt("load",function(){n.eBV(i);const o=n.XpG();return n.Njj(o.onImagenCargada())})("error",function(){n.eBV(i);const o=n.XpG();return n.Njj(o.onImagenError())}),n.k0s(),n.DNE(4,M,4,0,"div",11)(5,v,4,0,"div",12),n.k0s()(),n.j41(6,"section",13)(7,"ion-card",14)(8,"ion-card-header",15)(9,"ion-card-title",16),n.EFF(10),n.k0s(),n.j41(11,"ion-card-subtitle",17),n.EFF(12),n.nI1(13,"number"),n.k0s()(),n.j41(14,"ion-card-content",18)(15,"div",19)(16,"div",20),n.nrm(17,"ion-icon",21),n.j41(18,"div",22)(19,"span",23),n.EFF(20,"Vendedor"),n.k0s(),n.j41(21,"span",24),n.EFF(22),n.k0s()()(),n.j41(23,"div",20),n.nrm(24,"ion-icon",25),n.j41(25,"div",22)(26,"span",23),n.EFF(27,"Categor\xeda"),n.k0s(),n.j41(28,"span",24),n.EFF(29),n.k0s()()(),n.DNE(30,O,7,1,"div",26)(31,b,7,1,"div",26),n.k0s()()()(),n.j41(32,"section",27)(33,"div",28)(34,"ion-button",29),n.bIt("click",function(){n.eBV(i);const o=n.XpG();return n.Njj(o.agregarAlCarrito())}),n.nrm(35,"ion-icon",30),n.EFF(36," Agregar al Carrito "),n.k0s(),n.j41(37,"ion-button",31),n.bIt("click",function(){n.eBV(i);const o=n.XpG();return n.Njj(o.comprarAhora())}),n.nrm(38,"ion-icon",32),n.EFF(39," Comprar Ahora "),n.k0s(),n.j41(40,"ion-button",33),n.bIt("click",function(){n.eBV(i);const o=n.XpG();return n.Njj(o.abrirEnGoogleMaps())}),n.nrm(41,"ion-icon",34),n.EFF(42," Ver en Maps "),n.k0s(),n.j41(43,"ion-button",35),n.bIt("click",function(){n.eBV(i);const o=n.XpG();return n.Njj(o.contactarVendedor())}),n.nrm(44,"ion-icon",36),n.EFF(45," Contactar Vendedor "),n.k0s()(),n.DNE(46,j,5,0,"div",37),n.k0s(),n.bVm()}if(2&e){const i=n.XpG();n.R7$(3),n.AVh("image-loaded",i.imagenCargada)("image-error",i.imagenError),n.Y8G("src",i.imagenProducto,n.B4B)("alt",i.producto.nombre),n.R7$(),n.Y8G("ngIf",i.imagenError),n.R7$(),n.Y8G("ngIf",!i.imagenCargada&&!i.imagenError),n.R7$(5),n.JRh(i.producto.nombre),n.R7$(2),n.SpI(" $",n.i5U(13,17,i.producto.precio,"1.2-2")," "),n.R7$(10),n.JRh(i.producto.vendedor.nombre),n.R7$(7),n.JRh(i.producto.categoria||"No especificada"),n.R7$(),n.Y8G("ngIf",i.producto.descripcion),n.R7$(),n.Y8G("ngIf",i.producto.infoExtra),n.R7$(3),n.Y8G("disabled",i.esVendedor),n.R7$(3),n.Y8G("disabled",i.esVendedor),n.R7$(9),n.Y8G("ngIf",i.esVendedor)}}function E(e,c){1&e&&(n.j41(0,"div",50),n.nrm(1,"ion-spinner",51),n.j41(2,"p",52),n.EFF(3,"Cargando producto..."),n.k0s()())}const F=[{path:"",component:(()=>{var e;class c{constructor(t,o,r,d,l){this.route=t,this.http=o,this.authService=r,this.alertCtrl=d,this.navCtrl=l,this.producto=null,this.loading=!0,this.esVendedor=!1,this.imagenCargada=!1,this.imagenError=!1}ngOnInit(){this.route.paramMap.subscribe(t=>{const o=t.get("id");o?this.cargarProducto(o):(this.loading=!1,this.mostrarAlerta("Error","No se encontr\xf3 el producto solicitado"),this.navCtrl.navigateBack("/hub"))})}cargarProducto(t){var o=this;return(0,g.A)(function*(){try{const r=yield o.authService.getToken();if(!r)return o.mostrarAlerta("Sesi\xf3n requerida","Debes iniciar sesi\xf3n para ver este producto"),void o.navCtrl.navigateBack("/login");const d=new u.Lr({Authorization:`Bearer ${r}`}),l=yield o.http.get(`${m.c.apiUrl}/api/mercado/${t}`,{headers:d}).toPromise();if(!l)throw new Error("Producto no encontrado");o.producto=l,l.imagenUrl&&o.verificarAccesibilidadImagen(l.imagenUrl),o.esVendedor=yield o.verificarSiEsVendedor(l.vendedor.correo),o.loading=!1}catch{o.loading=!1,o.mostrarAlerta("Error","No se pudo cargar el producto"),o.navCtrl.navigateBack("/hub")}})()}verificarAccesibilidadImagen(t){const o=new Image;o.onload=()=>{},o.onerror=()=>{},o.src=t}get imagenProducto(){return this.producto?this.producto.imagenUrl&&""!==this.producto.imagenUrl.trim()&&"null"!==this.producto.imagenUrl&&"undefined"!==this.producto.imagenUrl&&this.producto.imagenUrl.startsWith("http")?this.producto.imagenUrl:this.producto.usaImagenGlobal?`${m.c.apiUrl}/api/productos/${this.producto.codigo}/imagen`:"assets/img/placeholder.jpg":"assets/images/producto-placeholder.png"}onImagenCargada(){this.imagenCargada=!0,this.imagenError=!1}onImagenError(){this.imagenError=!0,this.imagenCargada=!1}verificarSiEsVendedor(t){var o=this;return(0,g.A)(function*(){const r=yield o.authService.getUser();return(null==r?void 0:r.email)===t})()}agregarAlCarrito(){var t=this;return(0,g.A)(function*(){if(t.producto)try{const d=yield t.authService.getToken();if(!d)return t.mostrarAlerta("No autenticado","Debes iniciar sesi\xf3n para agregar productos al carrito."),void t.navCtrl.navigateForward("/login");if(t.esVendedor)return void t.mostrarAlerta("Acci\xf3n no permitida","No puedes agregar tus propios productos al carrito.");const l=new u.Lr({Authorization:`Bearer ${d}`,"Content-Type":"application/json"}),I={productoId:t.producto.codigo,cantidad:1};yield t.http.post(`${m.c.apiUrl}/api/carrito`,I,{headers:l}).toPromise(),t.mostrarAlerta("\xc9xito",`"${t.producto.nombre}" agregado al carrito.`)}catch(d){var o,r;let l="No se pudo agregar el producto al carrito.";null!==(o=d.error)&&void 0!==o&&o.error?l=d.error.error:null!==(r=d.error)&&void 0!==r&&r.mensaje&&(l=d.error.mensaje),t.mostrarAlerta("Error",l)}else t.mostrarAlerta("Error","No hay producto para agregar al carrito.")})()}comprarAhora(){this.producto&&this.mostrarAlerta("Funci\xf3n en desarrollo","La compra directa estar\xe1 disponible pronto.")}abrirEnGoogleMaps(){var t;if(null===(t=this.producto)||void 0===t||null===(t=t.vendedor)||void 0===t||!t.direccion)return void this.mostrarAlerta("Informaci\xf3n","No hay direcci\xf3n disponible para este vendedor.");const r=`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(this.producto.vendedor.direccion)}`;window.open(r,"_blank")}contactarVendedor(){var t;if(null===(t=this.producto)||void 0===t||null===(t=t.vendedor)||void 0===t||!t.telefono)return void this.mostrarAlerta("Informaci\xf3n","No hay tel\xe9fono disponible para este vendedor.");const o=this.producto.vendedor.telefono.replace(/\D/g,"");window.open(`https://wa.me/52${o}`,"_blank")}mostrarAlerta(t,o){var r=this;return(0,g.A)(function*(){yield(yield r.alertCtrl.create({header:t,message:o,buttons:["OK"]})).present()})()}volver(){this.navCtrl.navigateBack("/hub")}}return(e=c).\u0275fac=function(t){return new(t||e)(n.rXU(h.nX),n.rXU(u.Qq),n.rXU(C.u),n.rXU(a.hG),n.rXU(x.q9))},e.\u0275cmp=n.VBU({type:e,selectors:[["app-producto"]],standalone:!1,decls:12,vars:4,consts:[["cargando",""],[1,"product-header",3,"translucent"],["slot","start"],["fill","clear",1,"back-button",3,"click"],[1,"page-title"],[1,"product-content",3,"fullscreen"],[1,"content-wrapper"],[4,"ngIf","ngIfElse"],[1,"image-section"],[1,"image-container"],[1,"product-image",3,"load","error","src","alt"],["class","image-placeholder",4,"ngIf"],["class","image-loading",4,"ngIf"],[1,"info-section"],[1,"product-info-card"],[1,"card-header"],[1,"product-name"],[1,"product-price"],[1,"card-content"],[1,"info-grid"],[1,"info-item"],["name","storefront-outline",1,"info-icon"],[1,"info-text"],[1,"info-label"],[1,"info-value"],["name","pricetag-outline",1,"info-icon"],["class","info-item",4,"ngIf"],[1,"actions-section"],[1,"action-buttons"],["expand","block","color","success",1,"action-button",3,"click","disabled"],["slot","start","name","cart-outline"],["expand","block","color","primary",1,"action-button",3,"click","disabled"],["slot","start","name","flash-outline"],["expand","block","color","tertiary",1,"action-button",3,"click"],["slot","start","name","map-outline"],["expand","block","fill","outline","color","medium",1,"action-button",3,"click"],["slot","start","name","logo-whatsapp"],["class","owner-notice",4,"ngIf"],[1,"image-placeholder"],["name","image-outline",1,"placeholder-icon"],[1,"placeholder-text"],[1,"image-loading"],["name","crescent",1,"loading-spinner"],[1,"loading-text"],["name","document-text-outline",1,"info-icon"],[1,"info-value","description-text"],["name","information-circle-outline",1,"info-icon"],[1,"owner-notice"],["color","warning","outline",""],["name","information-circle-outline"],[1,"loading-state"],["name","crescent",1,"main-spinner"],[1,"loading-message"]],template:function(t,o){if(1&t){const r=n.RV6();n.j41(0,"ion-header",1)(1,"ion-toolbar")(2,"ion-buttons",2)(3,"ion-button",3),n.bIt("click",function(){return n.eBV(r),n.Njj(o.volver())}),n.EFF(4," Atras "),n.k0s()(),n.j41(5,"ion-title",4),n.EFF(6,"Detalles del Producto"),n.k0s()()(),n.j41(7,"ion-content",5)(8,"div",6),n.DNE(9,k,47,20,"ng-container",7)(10,E,4,0,"ng-template",null,0,n.C5r),n.k0s()()}if(2&t){const r=n.sdS(11);n.Y8G("translucent",!0),n.R7$(7),n.Y8G("fullscreen",!0),n.R7$(2),n.Y8G("ngIf",!o.loading&&o.producto)("ngIfElse",r)}},dependencies:[p.bT,a.Jm,a.QW,a.b_,a.I9,a.ME,a.HW,a.tN,a.ZB,a.W9,a.eU,a.iq,a.he,a.w2,a.BC,a.ai,p.QX],styles:['@charset "UTF-8";.product-header[_ngcontent-%COMP%]   .back-button[_ngcontent-%COMP%]{--color: white;--background-hover: rgba(255, 255, 255, .1)}.product-header[_ngcontent-%COMP%]   .page-title[_ngcontent-%COMP%]{font-weight:600;font-size:1.1rem}.product-content[_ngcontent-%COMP%]   .content-wrapper[_ngcontent-%COMP%]{padding:0}.image-section[_ngcontent-%COMP%]{padding:20px 0;border-bottom:1px solid #e0e0e0}.image-section[_ngcontent-%COMP%]   .image-container[_ngcontent-%COMP%]{position:relative;width:100%;max-width:300px;margin:0 auto;border-radius:16px;overflow:hidden;box-shadow:0 4px 16px #0000001a}.image-section[_ngcontent-%COMP%]   .product-image[_ngcontent-%COMP%]{width:100%;height:300px;object-fit:cover;display:block;transition:opacity .3s ease}.image-section[_ngcontent-%COMP%]   .product-image.image-loaded[_ngcontent-%COMP%]{opacity:1}.image-section[_ngcontent-%COMP%]   .product-image.image-error[_ngcontent-%COMP%]{display:none}.image-section[_ngcontent-%COMP%]   .image-placeholder[_ngcontent-%COMP%]{width:100%;height:300px;background:linear-gradient(135deg,#667eea,#764ba2);display:flex;flex-direction:column;align-items:center;justify-content:center}.image-section[_ngcontent-%COMP%]   .image-placeholder[_ngcontent-%COMP%]   .placeholder-icon[_ngcontent-%COMP%]{font-size:64px;margin-bottom:12px;opacity:.8}.image-section[_ngcontent-%COMP%]   .image-placeholder[_ngcontent-%COMP%]   .placeholder-text[_ngcontent-%COMP%]{margin:0;font-size:14px;opacity:.9}.image-section[_ngcontent-%COMP%]   .image-loading[_ngcontent-%COMP%]{width:100%;height:300px;display:flex;flex-direction:column;align-items:center;justify-content:center}.image-section[_ngcontent-%COMP%]   .image-loading[_ngcontent-%COMP%]   .loading-spinner[_ngcontent-%COMP%]{margin-bottom:12px;--color: var(--ion-color-primary)}.image-section[_ngcontent-%COMP%]   .image-loading[_ngcontent-%COMP%]   .loading-text[_ngcontent-%COMP%]{margin:0;color:#666;font-size:14px}.info-section[_ngcontent-%COMP%]{padding:20px 16px}.info-section[_ngcontent-%COMP%]   .product-info-card[_ngcontent-%COMP%]{margin:0;border-radius:16px;box-shadow:0 2px 12px #00000014;overflow:hidden}.info-section[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]{padding-bottom:8px}.info-section[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]   .product-name[_ngcontent-%COMP%]{font-size:1.4rem;font-weight:700;color:#2c3e50;margin-bottom:4px}.info-section[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]   .product-price[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:700;color:var(--ion-color-success);margin:0}.info-section[_ngcontent-%COMP%]   .card-content[_ngcontent-%COMP%]{padding-top:0}.info-section[_ngcontent-%COMP%]   .info-grid[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px}.info-section[_ngcontent-%COMP%]   .info-item[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:12px}.info-section[_ngcontent-%COMP%]   .info-item[_ngcontent-%COMP%]   .info-icon[_ngcontent-%COMP%]{font-size:20px;color:var(--ion-color-primary);margin-top:2px;flex-shrink:0}.info-section[_ngcontent-%COMP%]   .info-item[_ngcontent-%COMP%]   .info-text[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;gap:2px}.info-section[_ngcontent-%COMP%]   .info-item[_ngcontent-%COMP%]   .info-label[_ngcontent-%COMP%]{font-size:.8rem;color:#666;font-weight:500;text-transform:uppercase;letter-spacing:.5px}.info-section[_ngcontent-%COMP%]   .info-item[_ngcontent-%COMP%]   .info-value[_ngcontent-%COMP%]{font-size:.95rem;color:#2c3e50;line-height:1.4}.info-section[_ngcontent-%COMP%]   .info-item[_ngcontent-%COMP%]   .description-text[_ngcontent-%COMP%]{line-height:1.5}.actions-section[_ngcontent-%COMP%]{padding:0 16px 32px}.actions-section[_ngcontent-%COMP%]   .action-buttons[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px;margin-bottom:16px}.actions-section[_ngcontent-%COMP%]   .action-button[_ngcontent-%COMP%]{--border-radius: 12px;--box-shadow: 0 2px 8px rgba(0, 0, 0, .15);margin:0;height:50px;font-weight:600}.actions-section[_ngcontent-%COMP%]   .action-button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:20px}.actions-section[_ngcontent-%COMP%]   .owner-notice[_ngcontent-%COMP%]{text-align:center;padding:16px 0}.actions-section[_ngcontent-%COMP%]   .owner-notice[_ngcontent-%COMP%]   ion-chip[_ngcontent-%COMP%]{font-size:.9rem}.loading-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:60vh;padding:40px}.loading-state[_ngcontent-%COMP%]   .main-spinner[_ngcontent-%COMP%]{margin-bottom:20px;--color: var(--ion-color-primary)}.loading-state[_ngcontent-%COMP%]   .loading-message[_ngcontent-%COMP%]{color:#666;font-size:16px;margin:0;text-align:center}.product-info-card[_ngcontent-%COMP%]{transition:transform .2s ease,box-shadow .2s ease}.product-info-card[_ngcontent-%COMP%]:active{transform:translateY(2px);box-shadow:0 1px 4px #0000001a}.action-button[_ngcontent-%COMP%]{transition:all .2s ease}.action-button[_ngcontent-%COMP%]:active{transform:translateY(1px)}@media (max-width: 380px){.image-section[_ngcontent-%COMP%]   .image-container[_ngcontent-%COMP%]{max-width:250px}.info-section[_ngcontent-%COMP%]   .product-name[_ngcontent-%COMP%]{font-size:1.2rem}.info-section[_ngcontent-%COMP%]   .product-price[_ngcontent-%COMP%]{font-size:1.3rem}}@media (min-width: 768px){.content-wrapper[_ngcontent-%COMP%]{max-width:500px;margin:0 auto}.actions-section[_ngcontent-%COMP%]{padding-bottom:40px}}']}),c})()}];let y=(()=>{var e;class c{}return(e=c).\u0275fac=function(t){return new(t||e)},e.\u0275mod=n.$C({type:e}),e.\u0275inj=n.G2t({imports:[_.iI.forChild(F),_.iI]}),c})(),w=(()=>{var e;class c{}return(e=c).\u0275fac=function(t){return new(t||e)},e.\u0275mod=n.$C({type:e}),e.\u0275inj=n.G2t({imports:[p.MD,P.YN,a.bv,y]}),c})()}}]);