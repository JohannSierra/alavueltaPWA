"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5848],{5848:(w,h,d)=>{d.r(h),d.d(h,{ProductoPageModule:()=>U});var p=d(2881),_=d(4341),c=d(3092),P=d(5207),u=d(467),m=d(7643),f=d(5312),n=d(1360),C=d(7664),v=d(5844),x=d(5032);function M(e,l){1&e&&(n.j41(0,"div",38),n.nrm(1,"ion-icon",39),n.j41(2,"p",40),n.EFF(3,"Imagen no disponible"),n.k0s()())}function b(e,l){1&e&&(n.j41(0,"div",41),n.nrm(1,"ion-spinner",42),n.j41(2,"p",43),n.EFF(3,"Cargando imagen..."),n.k0s()())}function O(e,l){if(1&e&&(n.j41(0,"div",20),n.nrm(1,"ion-icon",44),n.j41(2,"div",22)(3,"span",23),n.EFF(4,"Descripci\xf3n"),n.k0s(),n.j41(5,"span",45),n.EFF(6),n.k0s()()()),2&e){const i=n.XpG(2);n.R7$(6),n.JRh(i.producto.descripcion)}}function E(e,l){if(1&e&&(n.j41(0,"div",20),n.nrm(1,"ion-icon",46),n.j41(2,"div",22)(3,"span",23),n.EFF(4,"Informaci\xf3n adicional"),n.k0s(),n.j41(5,"span",24),n.EFF(6),n.k0s()()()),2&e){const i=n.XpG(2);n.R7$(6),n.JRh(i.producto.infoExtra)}}function j(e,l){1&e&&(n.j41(0,"div",47)(1,"ion-chip",48),n.nrm(2,"ion-icon",49),n.j41(3,"ion-label"),n.EFF(4,"Este es tu producto"),n.k0s()()())}function k(e,l){if(1&e){const i=n.RV6();n.qex(0),n.j41(1,"section",8)(2,"div",9)(3,"img",10),n.bIt("load",function(){n.eBV(i);const t=n.XpG();return n.Njj(t.onImagenCargada())})("error",function(){n.eBV(i);const t=n.XpG();return n.Njj(t.onImagenError())}),n.k0s(),n.DNE(4,M,4,0,"div",11)(5,b,4,0,"div",12),n.k0s()(),n.j41(6,"section",13)(7,"ion-card",14)(8,"ion-card-header",15)(9,"ion-card-title",16),n.EFF(10),n.k0s(),n.j41(11,"ion-card-subtitle",17),n.EFF(12),n.nI1(13,"number"),n.k0s()(),n.j41(14,"ion-card-content",18)(15,"div",19)(16,"div",20),n.nrm(17,"ion-icon",21),n.j41(18,"div",22)(19,"span",23),n.EFF(20,"Vendedor"),n.k0s(),n.j41(21,"span",24),n.EFF(22),n.k0s()()(),n.j41(23,"div",20),n.nrm(24,"ion-icon",25),n.j41(25,"div",22)(26,"span",23),n.EFF(27,"Categor\xeda"),n.k0s(),n.j41(28,"span",24),n.EFF(29),n.k0s()()(),n.DNE(30,O,7,1,"div",26)(31,E,7,1,"div",26),n.k0s()()()(),n.j41(32,"section",27)(33,"div",28)(34,"ion-button",29),n.bIt("click",function(){n.eBV(i);const t=n.XpG();return n.Njj(t.agregarAlCarrito())}),n.nrm(35,"ion-icon",30),n.EFF(36," Agregar al Carrito "),n.k0s(),n.j41(37,"ion-button",31),n.bIt("click",function(){n.eBV(i);const t=n.XpG();return n.Njj(t.comprarAhora())}),n.nrm(38,"ion-icon",32),n.EFF(39," Comprar Ahora "),n.k0s(),n.j41(40,"ion-button",33),n.bIt("click",function(){n.eBV(i);const t=n.XpG();return n.Njj(t.abrirEnGoogleMaps())}),n.nrm(41,"ion-icon",34),n.EFF(42," Ver en Maps "),n.k0s(),n.j41(43,"ion-button",35),n.bIt("click",function(){n.eBV(i);const t=n.XpG();return n.Njj(t.contactarVendedor())}),n.nrm(44,"ion-icon",36),n.EFF(45," Contactar Vendedor "),n.k0s()(),n.DNE(46,j,5,0,"div",37),n.k0s(),n.bVm()}if(2&e){const i=n.XpG();n.R7$(3),n.AVh("image-loaded",i.imagenCargada)("image-error",i.imagenError),n.Y8G("src",i.imagenProducto,n.B4B)("alt",i.producto.nombre),n.R7$(),n.Y8G("ngIf",i.imagenError),n.R7$(),n.Y8G("ngIf",!i.imagenCargada&&!i.imagenError),n.R7$(5),n.JRh(i.producto.nombre),n.R7$(2),n.SpI(" $",n.i5U(13,17,i.producto.precio,"1.2-2")," "),n.R7$(10),n.JRh(i.producto.vendedor.nombre),n.R7$(7),n.JRh(i.producto.categoria||"No especificada"),n.R7$(),n.Y8G("ngIf",i.producto.descripcion),n.R7$(),n.Y8G("ngIf",i.producto.infoExtra),n.R7$(3),n.Y8G("disabled",i.esVendedor),n.R7$(3),n.Y8G("disabled",i.esVendedor),n.R7$(9),n.Y8G("ngIf",i.esVendedor)}}function y(e,l){1&e&&(n.j41(0,"div",50),n.nrm(1,"ion-spinner",51),n.j41(2,"p",52),n.EFF(3,"Cargando producto..."),n.k0s()())}const F=[{path:"",component:(()=>{var e;class l{constructor(o,t,r,s,g){this.route=o,this.http=t,this.authService=r,this.alertCtrl=s,this.navCtrl=g,this.producto=null,this.loading=!0,this.esVendedor=!1,this.imagenCargada=!1,this.imagenError=!1}ngOnInit(){this.route.paramMap.subscribe(o=>{const t=o.get("id");t?this.cargarProducto(t):(console.warn("No se recibi\xf3 id del producto"),this.loading=!1,this.mostrarAlerta("Error","No se encontr\xf3 el producto solicitado"),this.navCtrl.navigateBack("/hub"))})}cargarProducto(o){var t=this;return(0,u.A)(function*(){try{var r;const s=yield t.authService.getToken();if(!s)return t.mostrarAlerta("Sesi\xf3n requerida","Debes iniciar sesi\xf3n para ver este producto"),void t.navCtrl.navigateBack("/login");const g=new m.Lr({Authorization:`Bearer ${s}`}),a=yield t.http.get(`${f.c.apiUrl}/api/mercado/${o}`,{headers:g}).toPromise();if(!a)throw new Error("Producto no encontrado");t.producto=a,console.log("\u{1f50d} DEBUG IMAGEN DEL PRODUCTO:"),console.log("Producto completo:",a),console.log("\xbfTiene imagenUrl?:",!!a.imagenUrl),console.log("imagenUrl value:",a.imagenUrl),console.log("\xbfEs string vac\xedo?:",""===a.imagenUrl),console.log("\xbfEs null?:",null===a.imagenUrl),console.log("\xbfEs undefined?:",void 0===a.imagenUrl),console.log('\xbfEs string "null"?:',"null"===a.imagenUrl),console.log('\xbfEs string "undefined"?:',"undefined"===a.imagenUrl),console.log("\xbfEmpieza con http?:",null===(r=a.imagenUrl)||void 0===r?void 0:r.startsWith("http")),console.log("\xbfusaImagenGlobal?:",a.usaImagenGlobal),a.imagenUrl&&(console.log("\u{1f4cf} Longitud de imagenUrl:",a.imagenUrl.length),console.log("\u{1f517} URL completa:",a.imagenUrl),t.verificarAccesibilidadImagen(a.imagenUrl)),t.esVendedor=yield t.verificarSiEsVendedor(a.vendedor.correo),t.loading=!1}catch(s){console.error("Error cargando producto:",s),t.loading=!1,t.mostrarAlerta("Error","No se pudo cargar el producto"),t.navCtrl.navigateBack("/hub")}})()}verificarAccesibilidadImagen(o){const t=new Image;t.onload=()=>{console.log("\u2705 La imagen ES accesible y se puede cargar"),console.log("Dimensiones:",t.naturalWidth+"x"+t.naturalHeight)},t.onerror=()=>{console.log("\u274c La imagen NO es accesible. Posibles causas:"),console.log("   - URL incorrecta"),console.log("   - Problemas de CORS"),console.log("   - Imagen borrada de Cloudinary"),console.log("   - Token de acceso expirado"),console.log("   - Problemas de red")},t.src=o}get imagenProducto(){if(!this.producto)return"assets/images/producto-placeholder.png";if(console.log("\u{1f504} Evaluando imagen para:",this.producto.nombre),this.producto.imagenUrl&&""!==this.producto.imagenUrl.trim()&&"null"!==this.producto.imagenUrl&&"undefined"!==this.producto.imagenUrl&&this.producto.imagenUrl.startsWith("http"))return console.log("\u{1f3af} Usando imagenUrl directa:",this.producto.imagenUrl),this.producto.imagenUrl;if(this.producto.usaImagenGlobal){const o=`${f.c.apiUrl}/api/productos/${this.producto.codigo}/imagen`;return console.log("\u{1f310} Usando imagen global:",o),o}return console.log("\u{1f6ab} No hay imagen disponible - usando placeholder"),"assets/img/placeholder.jpg"}onImagenCargada(){console.log("\u2705 Imagen cargada exitosamente"),this.imagenCargada=!0,this.imagenError=!1}onImagenError(){console.error("\u274c Error cargando la imagen"),this.imagenError=!0,this.imagenCargada=!1,console.log("URL que fall\xf3:",this.imagenProducto),console.log("Producto actual:",this.producto)}verificarSiEsVendedor(o){var t=this;return(0,u.A)(function*(){const r=yield t.authService.getUser();return(null==r?void 0:r.email)===o})()}agregarAlCarrito(){var o=this;return(0,u.A)(function*(){if(o.producto)try{const s=yield o.authService.getToken();if(!s)return o.mostrarAlerta("No autenticado","Debes iniciar sesi\xf3n para agregar productos al carrito."),void o.navCtrl.navigateForward("/login");if(o.esVendedor)return void o.mostrarAlerta("Acci\xf3n no permitida","No puedes agregar tus propios productos al carrito.");const g=new m.Lr({Authorization:`Bearer ${s}`,"Content-Type":"application/json"}),a={productoId:o.producto.codigo,cantidad:1};yield o.http.post(`${f.c.apiUrl}/api/carrito`,a,{headers:g}).toPromise(),o.mostrarAlerta("\xc9xito",`"${o.producto.nombre}" agregado al carrito.`)}catch(s){var t,r;console.error("Error agregando al carrito:",s);let g="No se pudo agregar el producto al carrito.";null!==(t=s.error)&&void 0!==t&&t.error?g=s.error.error:null!==(r=s.error)&&void 0!==r&&r.mensaje&&(g=s.error.mensaje),o.mostrarAlerta("Error",g)}else o.mostrarAlerta("Error","No hay producto para agregar al carrito.")})()}comprarAhora(){this.producto&&(console.log("Compra iniciada para:",this.producto),this.mostrarAlerta("Funci\xf3n en desarrollo","La compra directa estar\xe1 disponible pronto."))}abrirEnGoogleMaps(){var o;if(null===(o=this.producto)||void 0===o||null===(o=o.vendedor)||void 0===o||!o.direccion)return void this.mostrarAlerta("Informaci\xf3n","No hay direcci\xf3n disponible para este vendedor.");const r=`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(this.producto.vendedor.direccion)}`;window.open(r,"_blank")}contactarVendedor(){var o;if(null===(o=this.producto)||void 0===o||null===(o=o.vendedor)||void 0===o||!o.telefono)return void this.mostrarAlerta("Informaci\xf3n","No hay tel\xe9fono disponible para este vendedor.");const t=this.producto.vendedor.telefono.replace(/\D/g,"");window.open(`https://wa.me/52${t}`,"_blank")}mostrarAlerta(o,t){var r=this;return(0,u.A)(function*(){yield(yield r.alertCtrl.create({header:o,message:t,buttons:["OK"]})).present()})()}volver(){this.navCtrl.navigateBack("/hub")}}return(e=l).\u0275fac=function(o){return new(o||e)(n.rXU(C.nX),n.rXU(m.Qq),n.rXU(v.u),n.rXU(c.hG),n.rXU(x.q9))},e.\u0275cmp=n.VBU({type:e,selectors:[["app-producto"]],standalone:!1,decls:12,vars:4,consts:[["cargando",""],[1,"product-header",3,"translucent"],["slot","start"],["fill","clear",1,"back-button",3,"click"],[1,"page-title"],[1,"product-content",3,"fullscreen"],[1,"content-wrapper"],[4,"ngIf","ngIfElse"],[1,"image-section"],[1,"image-container"],[1,"product-image",3,"load","error","src","alt"],["class","image-placeholder",4,"ngIf"],["class","image-loading",4,"ngIf"],[1,"info-section"],[1,"product-info-card"],[1,"card-header"],[1,"product-name"],[1,"product-price"],[1,"card-content"],[1,"info-grid"],[1,"info-item"],["name","storefront-outline",1,"info-icon"],[1,"info-text"],[1,"info-label"],[1,"info-value"],["name","pricetag-outline",1,"info-icon"],["class","info-item",4,"ngIf"],[1,"actions-section"],[1,"action-buttons"],["expand","block","color","success",1,"action-button",3,"click","disabled"],["slot","start","name","cart-outline"],["expand","block","color","primary",1,"action-button",3,"click","disabled"],["slot","start","name","flash-outline"],["expand","block","color","tertiary",1,"action-button",3,"click"],["slot","start","name","map-outline"],["expand","block","fill","outline","color","medium",1,"action-button",3,"click"],["slot","start","name","logo-whatsapp"],["class","owner-notice",4,"ngIf"],[1,"image-placeholder"],["name","image-outline",1,"placeholder-icon"],[1,"placeholder-text"],[1,"image-loading"],["name","crescent",1,"loading-spinner"],[1,"loading-text"],["name","document-text-outline",1,"info-icon"],[1,"info-value","description-text"],["name","information-circle-outline",1,"info-icon"],[1,"owner-notice"],["color","warning","outline",""],["name","information-circle-outline"],[1,"loading-state"],["name","crescent",1,"main-spinner"],[1,"loading-message"]],template:function(o,t){if(1&o){const r=n.RV6();n.j41(0,"ion-header",1)(1,"ion-toolbar")(2,"ion-buttons",2)(3,"ion-button",3),n.bIt("click",function(){return n.eBV(r),n.Njj(t.volver())}),n.EFF(4," Atras "),n.k0s()(),n.j41(5,"ion-title",4),n.EFF(6,"Detalles del Producto"),n.k0s()()(),n.j41(7,"ion-content",5)(8,"div",6),n.DNE(9,k,47,20,"ng-container",7)(10,y,4,0,"ng-template",null,0,n.C5r),n.k0s()()}if(2&o){const r=n.sdS(11);n.Y8G("translucent",!0),n.R7$(7),n.Y8G("fullscreen",!0),n.R7$(2),n.Y8G("ngIf",!t.loading&&t.producto)("ngIfElse",r)}},dependencies:[p.bT,c.Jm,c.QW,c.b_,c.I9,c.ME,c.HW,c.tN,c.ZB,c.W9,c.eU,c.iq,c.he,c.w2,c.BC,c.ai,p.QX],styles:['@charset "UTF-8";.product-header[_ngcontent-%COMP%]   .back-button[_ngcontent-%COMP%]{--color: white;--background-hover: rgba(255, 255, 255, .1)}.product-header[_ngcontent-%COMP%]   .page-title[_ngcontent-%COMP%]{font-weight:600;font-size:1.1rem}.product-content[_ngcontent-%COMP%]   .content-wrapper[_ngcontent-%COMP%]{padding:0}.image-section[_ngcontent-%COMP%]{padding:20px 0;border-bottom:1px solid #e0e0e0}.image-section[_ngcontent-%COMP%]   .image-container[_ngcontent-%COMP%]{position:relative;width:100%;max-width:300px;margin:0 auto;border-radius:16px;overflow:hidden;box-shadow:0 4px 16px #0000001a}.image-section[_ngcontent-%COMP%]   .product-image[_ngcontent-%COMP%]{width:100%;height:300px;object-fit:cover;display:block;transition:opacity .3s ease}.image-section[_ngcontent-%COMP%]   .product-image.image-loaded[_ngcontent-%COMP%]{opacity:1}.image-section[_ngcontent-%COMP%]   .product-image.image-error[_ngcontent-%COMP%]{display:none}.image-section[_ngcontent-%COMP%]   .image-placeholder[_ngcontent-%COMP%]{width:100%;height:300px;background:linear-gradient(135deg,#667eea,#764ba2);display:flex;flex-direction:column;align-items:center;justify-content:center}.image-section[_ngcontent-%COMP%]   .image-placeholder[_ngcontent-%COMP%]   .placeholder-icon[_ngcontent-%COMP%]{font-size:64px;margin-bottom:12px;opacity:.8}.image-section[_ngcontent-%COMP%]   .image-placeholder[_ngcontent-%COMP%]   .placeholder-text[_ngcontent-%COMP%]{margin:0;font-size:14px;opacity:.9}.image-section[_ngcontent-%COMP%]   .image-loading[_ngcontent-%COMP%]{width:100%;height:300px;display:flex;flex-direction:column;align-items:center;justify-content:center}.image-section[_ngcontent-%COMP%]   .image-loading[_ngcontent-%COMP%]   .loading-spinner[_ngcontent-%COMP%]{margin-bottom:12px;--color: var(--ion-color-primary)}.image-section[_ngcontent-%COMP%]   .image-loading[_ngcontent-%COMP%]   .loading-text[_ngcontent-%COMP%]{margin:0;color:#666;font-size:14px}.info-section[_ngcontent-%COMP%]{padding:20px 16px}.info-section[_ngcontent-%COMP%]   .product-info-card[_ngcontent-%COMP%]{margin:0;border-radius:16px;box-shadow:0 2px 12px #00000014;overflow:hidden}.info-section[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]{padding-bottom:8px}.info-section[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]   .product-name[_ngcontent-%COMP%]{font-size:1.4rem;font-weight:700;color:#2c3e50;margin-bottom:4px}.info-section[_ngcontent-%COMP%]   .card-header[_ngcontent-%COMP%]   .product-price[_ngcontent-%COMP%]{font-size:1.5rem;font-weight:700;color:var(--ion-color-success);margin:0}.info-section[_ngcontent-%COMP%]   .card-content[_ngcontent-%COMP%]{padding-top:0}.info-section[_ngcontent-%COMP%]   .info-grid[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:16px}.info-section[_ngcontent-%COMP%]   .info-item[_ngcontent-%COMP%]{display:flex;align-items:flex-start;gap:12px}.info-section[_ngcontent-%COMP%]   .info-item[_ngcontent-%COMP%]   .info-icon[_ngcontent-%COMP%]{font-size:20px;color:var(--ion-color-primary);margin-top:2px;flex-shrink:0}.info-section[_ngcontent-%COMP%]   .info-item[_ngcontent-%COMP%]   .info-text[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;gap:2px}.info-section[_ngcontent-%COMP%]   .info-item[_ngcontent-%COMP%]   .info-label[_ngcontent-%COMP%]{font-size:.8rem;color:#666;font-weight:500;text-transform:uppercase;letter-spacing:.5px}.info-section[_ngcontent-%COMP%]   .info-item[_ngcontent-%COMP%]   .info-value[_ngcontent-%COMP%]{font-size:.95rem;color:#2c3e50;line-height:1.4}.info-section[_ngcontent-%COMP%]   .info-item[_ngcontent-%COMP%]   .description-text[_ngcontent-%COMP%]{line-height:1.5}.actions-section[_ngcontent-%COMP%]{padding:0 16px 32px}.actions-section[_ngcontent-%COMP%]   .action-buttons[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px;margin-bottom:16px}.actions-section[_ngcontent-%COMP%]   .action-button[_ngcontent-%COMP%]{--border-radius: 12px;--box-shadow: 0 2px 8px rgba(0, 0, 0, .15);margin:0;height:50px;font-weight:600}.actions-section[_ngcontent-%COMP%]   .action-button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:20px}.actions-section[_ngcontent-%COMP%]   .owner-notice[_ngcontent-%COMP%]{text-align:center;padding:16px 0}.actions-section[_ngcontent-%COMP%]   .owner-notice[_ngcontent-%COMP%]   ion-chip[_ngcontent-%COMP%]{font-size:.9rem}.loading-state[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;height:60vh;padding:40px}.loading-state[_ngcontent-%COMP%]   .main-spinner[_ngcontent-%COMP%]{margin-bottom:20px;--color: var(--ion-color-primary)}.loading-state[_ngcontent-%COMP%]   .loading-message[_ngcontent-%COMP%]{color:#666;font-size:16px;margin:0;text-align:center}.product-info-card[_ngcontent-%COMP%]{transition:transform .2s ease,box-shadow .2s ease}.product-info-card[_ngcontent-%COMP%]:active{transform:translateY(2px);box-shadow:0 1px 4px #0000001a}.action-button[_ngcontent-%COMP%]{transition:all .2s ease}.action-button[_ngcontent-%COMP%]:active{transform:translateY(1px)}@media (max-width: 380px){.image-section[_ngcontent-%COMP%]   .image-container[_ngcontent-%COMP%]{max-width:250px}.info-section[_ngcontent-%COMP%]   .product-name[_ngcontent-%COMP%]{font-size:1.2rem}.info-section[_ngcontent-%COMP%]   .product-price[_ngcontent-%COMP%]{font-size:1.3rem}}@media (min-width: 768px){.content-wrapper[_ngcontent-%COMP%]{max-width:500px;margin:0 auto}.actions-section[_ngcontent-%COMP%]{padding-bottom:40px}}']}),l})()}];let I=(()=>{var e;class l{}return(e=l).\u0275fac=function(o){return new(o||e)},e.\u0275mod=n.$C({type:e}),e.\u0275inj=n.G2t({imports:[P.iI.forChild(F),P.iI]}),l})(),U=(()=>{var e;class l{}return(e=l).\u0275fac=function(o){return new(o||e)},e.\u0275mod=n.$C({type:e}),e.\u0275inj=n.G2t({imports:[p.MD,_.YN,c.bv,I]}),l})()}}]);