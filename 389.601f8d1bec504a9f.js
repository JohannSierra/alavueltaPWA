"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[389],{389:(B,f,l)=>{l.r(f),l.d(f,{EditarPageModule:()=>T});var h=l(2881),m=l(4341),r=l(3092),v=l(5207),g=l(467),u=l(7643),p=l(5312),e=l(1360),E=l(7664),I=l(5032),j=l(5844);const P=["inputImagen"];function b(a,d){1&a&&(e.j41(0,"div",12),e.nrm(1,"ion-spinner",13),e.j41(2,"p"),e.EFF(3,"Cargando producto..."),e.k0s()())}function k(a,d){if(1&a){const o=e.RV6();e.j41(0,"div",33),e.bIt("click",function(){e.eBV(o);const i=e.XpG(2);return e.Njj(i.openImagePreview())}),e.nrm(1,"img",34),e.j41(2,"div",35),e.nrm(3,"ion-icon",36),e.k0s()()}if(2&a){const o=e.XpG(2);e.R7$(),e.Y8G("src",o.imagenPreview,e.B4B)}}function M(a,d){1&a&&(e.j41(0,"div",37),e.nrm(1,"ion-icon",38),e.j41(2,"p"),e.EFF(3,"No hay imagen"),e.k0s()())}function C(a,d){if(1&a){const o=e.RV6();e.j41(0,"ion-button",39),e.bIt("click",function(){e.eBV(o);const i=e.XpG(2);return e.Njj(i.removeImage())}),e.nrm(1,"ion-icon",40),e.EFF(2," Eliminar "),e.k0s()}}function x(a,d){1&a&&e.nrm(0,"ion-spinner",41)}function y(a,d){if(1&a){const o=e.RV6();e.j41(0,"div",14)(1,"div",15),e.DNE(2,k,4,1,"div",16)(3,M,4,0,"div",17),e.j41(4,"div",18)(5,"ion-button",19),e.bIt("click",function(){e.eBV(o);const i=e.XpG();return e.Njj(i.triggerInputImagenClick())}),e.nrm(6,"ion-icon",20),e.EFF(7),e.k0s(),e.DNE(8,C,3,0,"ion-button",21),e.k0s(),e.j41(9,"input",22,0),e.bIt("change",function(i){e.eBV(o);const t=e.XpG();return e.Njj(t.onImageSelected(i))}),e.k0s()(),e.j41(11,"ion-list",23)(12,"ion-item")(13,"ion-label",24),e.EFF(14,"C\xf3digo"),e.k0s(),e.j41(15,"ion-input",25),e.mxI("ngModelChange",function(i){e.eBV(o);const t=e.XpG();return e.DH7(t.producto.codigo,i)||(t.producto.codigo=i),e.Njj(i)}),e.k0s()(),e.j41(16,"ion-item")(17,"ion-label",24),e.EFF(18,"Nombre *"),e.k0s(),e.j41(19,"ion-input",25),e.mxI("ngModelChange",function(i){e.eBV(o);const t=e.XpG();return e.DH7(t.producto.nombre,i)||(t.producto.nombre=i),e.Njj(i)}),e.k0s()(),e.j41(20,"ion-item")(21,"ion-label",24),e.EFF(22,"Precio ($) *"),e.k0s(),e.j41(23,"ion-input",26),e.mxI("ngModelChange",function(i){e.eBV(o);const t=e.XpG();return e.DH7(t.producto.precio,i)||(t.producto.precio=i),e.Njj(i)}),e.k0s()(),e.j41(24,"ion-item")(25,"ion-label",24),e.EFF(26,"Cantidad *"),e.k0s(),e.j41(27,"ion-input",27),e.mxI("ngModelChange",function(i){e.eBV(o);const t=e.XpG();return e.DH7(t.producto.cantidad,i)||(t.producto.cantidad=i),e.Njj(i)}),e.k0s()(),e.j41(28,"ion-item")(29,"ion-label",24),e.EFF(30,"Categor\xeda"),e.k0s(),e.j41(31,"ion-input",28),e.mxI("ngModelChange",function(i){e.eBV(o);const t=e.XpG();return e.DH7(t.producto.categoria,i)||(t.producto.categoria=i),e.Njj(i)}),e.k0s()(),e.j41(32,"ion-item")(33,"ion-label",24),e.EFF(34,"Descripci\xf3n"),e.k0s(),e.j41(35,"ion-textarea",29),e.mxI("ngModelChange",function(i){e.eBV(o);const t=e.XpG();return e.DH7(t.producto.descripcion,i)||(t.producto.descripcion=i),e.Njj(i)}),e.k0s()(),e.j41(36,"ion-item")(37,"ion-label",24),e.EFF(38,"Informaci\xf3n adicional"),e.k0s(),e.j41(39,"ion-textarea",30),e.mxI("ngModelChange",function(i){e.eBV(o);const t=e.XpG();return e.DH7(t.producto.infoExtra,i)||(t.producto.infoExtra=i),e.Njj(i)}),e.k0s()()(),e.j41(40,"ion-button",31),e.bIt("click",function(){e.eBV(o);const i=e.XpG();return e.Njj(i.guardarCambios())}),e.DNE(41,x,1,0,"ion-spinner",32),e.EFF(42),e.k0s()()}if(2&a){const o=e.XpG();e.R7$(2),e.Y8G("ngIf",o.imagenPreview),e.R7$(),e.Y8G("ngIf",!o.imagenPreview),e.R7$(4),e.SpI(" ",o.imagenPreview?"Cambiar imagen":"Agregar imagen"," "),e.R7$(),e.Y8G("ngIf",o.imagenPreview),e.R7$(7),e.R50("ngModel",o.producto.codigo),e.R7$(4),e.R50("ngModel",o.producto.nombre),e.R7$(4),e.R50("ngModel",o.producto.precio),e.R7$(4),e.R50("ngModel",o.producto.cantidad),e.R7$(4),e.R50("ngModel",o.producto.categoria),e.R7$(4),e.R50("ngModel",o.producto.descripcion),e.R7$(4),e.R50("ngModel",o.producto.infoExtra),e.R7$(),e.Y8G("disabled",o.isSaving),e.R7$(),e.Y8G("ngIf",o.isSaving),e.R7$(),e.SpI(" ",o.isSaving?"Guardando...":"Guardar cambios"," ")}}function G(a,d){if(1&a&&e.nrm(0,"img",46),2&a){const o=e.XpG(2);e.Y8G("src",o.imagenPreview,e.B4B)}}function F(a,d){if(1&a){const o=e.RV6();e.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),e.EFF(3,"Vista ampliada"),e.k0s(),e.j41(4,"ion-buttons",5)(5,"ion-button",3),e.bIt("click",function(){e.eBV(o);const i=e.XpG();return e.Njj(i.closeImageModal())}),e.nrm(6,"ion-icon",42),e.k0s()()()(),e.j41(7,"ion-content",43)(8,"div",44),e.DNE(9,G,1,1,"img",45),e.k0s()()}if(2&a){const o=e.XpG();e.R7$(9),e.Y8G("ngIf",o.imagenPreview)}}const R=[{path:"",component:(()=>{var a;class d{constructor(n,i,t,c,s,_){this.route=n,this.navCtrl=i,this.http=t,this.authService=c,this.alertCtrl=s,this.loadingCtrl=_,this.productoId="",this.producto={_id:"",codigo:"",nombre:"",precio:0,cantidad:0,categoria:"",descripcion:"",infoExtra:"",usuario:""},this.showImageModal=!1,this.imagenFile=null,this.imagenPreview=null,this.isLoading=!1,this.isSaving=!1}ngOnInit(){var n=this;return(0,g.A)(function*(){n.productoId=n.route.snapshot.paramMap.get("id")||"",n.productoId&&(yield n.cargarProducto())})()}cargarProducto(){var n=this;return(0,g.A)(function*(){n.isLoading=!0;const i=yield n.loadingCtrl.create({message:"Cargando producto..."});yield i.present();try{const t=yield n.authService.getToken();if(!t)throw new Error("No autenticado");const c=new u.Lr({Authorization:`Bearer ${t}`}),s=yield n.http.get(`${p.c.apiUrl}/api/inventario/${n.productoId}`,{headers:c}).toPromise();if(!s)throw new Error("Producto no encontrado");n.producto=s,n.imagenPreview=s.imagenUrl||null}catch(t){console.error("Error cargando producto:",t),n.mostrarAlerta("Error","No se pudo cargar el producto"),n.navCtrl.navigateBack("/inventario")}finally{i.dismiss(),n.isLoading=!1}})()}onImageSelected(n){const i=n.target;if(i.files&&i.files[0]){const t=i.files[0];if(t.size>5242880)return void this.mostrarAlerta("Error","La imagen no debe exceder los 5MB");if(!t.type.match(/image\/(jpeg|png|jpg|webp)/))return void this.mostrarAlerta("Error","Formato de imagen no soportado (solo JPEG, PNG, JPG o WEBP)");this.imagenFile=t;const c=new FileReader;c.onload=()=>{this.imagenPreview=c.result},c.readAsDataURL(t)}}removeImage(){this.imagenFile=null,this.imagenPreview=null,this.inputImagen&&(this.inputImagen.nativeElement.value="")}guardarCambios(){var n=this;return(0,g.A)(function*(){if(n.isSaving)return;n.isSaving=!0;const i=yield n.loadingCtrl.create({message:"Guardando cambios..."});yield i.present();try{const c=yield n.authService.getToken();if(!c)throw new Error("No autenticado");const s=new u.Lr({Authorization:`Bearer ${c}`,"Content-Type":"application/json"}),_={codigo:n.producto.codigo,nombre:n.producto.nombre,precio:n.producto.precio,cantidad:n.producto.cantidad,categoria:n.producto.categoria,descripcion:n.producto.descripcion,infoExtra:n.producto.infoExtra};yield n.http.put(`${p.c.apiUrl}/api/inventario/${n.productoId}`,_,{headers:s}).toPromise(),n.imagenFile?yield n.subirImagen():null===n.imagenPreview&&n.producto.imagenUrl&&(yield n.eliminarImagenBackend()),n.mostrarAlerta("\xc9xito","Producto actualizado correctamente"),n.navCtrl.navigateBack("/inventario")}catch(c){var t;console.error("Error guardando producto:",c);let s="Error al guardar los cambios";null!==(t=c.error)&&void 0!==t&&t.mensaje?s=c.error.mensaje:c.message&&(s=c.message),n.mostrarAlerta("Error",s)}finally{i.dismiss(),n.isSaving=!1}})()}subirImagen(){var n=this;return(0,g.A)(function*(){if(!n.imagenFile)return;const i=yield n.authService.getToken();if(!i)return;const t=new FormData;t.append("imagen",n.imagenFile),t.append("codigo",n.producto.codigo),t.append("nombre",n.producto.nombre),t.append("precio",n.producto.precio.toString()),t.append("cantidad",n.producto.cantidad.toString()),t.append("categoria",n.producto.categoria),t.append("descripcion",n.producto.descripcion),t.append("infoExtra",n.producto.infoExtra);const c=new u.Lr({Authorization:`Bearer ${i}`});yield n.http.put(`${p.c.apiUrl}/api/inventario/${n.productoId}`,t,{headers:c}).toPromise()})()}eliminarImagenBackend(){var n=this;return(0,g.A)(function*(){const i=yield n.authService.getToken();if(!i)return;const t=new u.Lr({Authorization:`Bearer ${i}`});yield n.http.delete(`${p.c.apiUrl}/api/inventario/${n.productoId}/imagen`,{headers:t}).toPromise()})()}mostrarConfirmacionSalir(){var n=this;return(0,g.A)(function*(){yield(yield n.alertCtrl.create({header:"\xbfSalir sin guardar?",message:"Tienes cambios sin guardar. \xbfEst\xe1s seguro de que quieres salir?",buttons:[{text:"Cancelar",role:"cancel"},{text:"Salir",handler:()=>{n.navCtrl.navigateBack("/inventario")}}]})).present()})()}mostrarAlerta(n,i){var t=this;return(0,g.A)(function*(){yield(yield t.alertCtrl.create({header:n,message:i,buttons:["OK"]})).present()})()}triggerInputImagenClick(){this.inputImagen&&this.inputImagen.nativeElement&&this.inputImagen.nativeElement.click()}openImagePreview(){this.showImageModal=!0}closeImageModal(){this.showImageModal=!1}}return(a=d).\u0275fac=function(n){return new(n||a)(e.rXU(E.nX),e.rXU(I.q9),e.rXU(u.Qq),e.rXU(j.u),e.rXU(r.hG),e.rXU(r.Xi))},a.\u0275cmp=e.VBU({type:a,selectors:[["app-editar"]],viewQuery:function(n,i){if(1&n&&e.GBs(P,5),2&n){let t;e.mGM(t=e.lsd())&&(i.inputImagen=t.first)}},standalone:!1,decls:15,vars:6,consts:[["inputImagen",""],[3,"translucent"],["slot","start"],[3,"click"],["name","arrow-back","slot","icon-only"],["slot","end"],[3,"click","disabled"],["name","save","slot","icon-only"],[1,"ion-padding",3,"fullscreen"],["class","loading-overlay",4,"ngIf"],["class","form-container",4,"ngIf"],[3,"ionModalDidDismiss","isOpen"],[1,"loading-overlay"],["name","crescent"],[1,"form-container"],[1,"image-section","ion-margin-bottom"],["class","image-container",3,"click",4,"ngIf"],["class","no-image",4,"ngIf"],[1,"image-actions"],["expand","block","fill","outline",3,"click"],["name","camera","slot","start"],["expand","block","fill","outline","color","danger",3,"click",4,"ngIf"],["type","file","accept","image/jpeg, image/png, image/jpg, image/webp",2,"display","none",3,"change"],["lines","full",1,"ion-margin-bottom"],["position","floating"],["type","text","required","",3,"ngModelChange","ngModel"],["type","number","min","0","step","0.01","required","",3,"ngModelChange","ngModel"],["type","number","min","0","required","",3,"ngModelChange","ngModel"],["type","text",3,"ngModelChange","ngModel"],["rows","3","autoGrow","",3,"ngModelChange","ngModel"],["rows","2","autoGrow","",3,"ngModelChange","ngModel"],["expand","block","color","primary",3,"click","disabled"],["name","crescent","slot","start",4,"ngIf"],[1,"image-container",3,"click"],["alt","Imagen del producto",1,"product-image",3,"src"],[1,"image-overlay"],["name","expand",1,"zoom-icon"],[1,"no-image"],["name","image",1,"no-image-icon"],["expand","block","fill","outline","color","danger",3,"click"],["name","trash","slot","start"],["name","crescent","slot","start"],["name","close","slot","icon-only"],[1,"modal-content"],[1,"image-modal-container"],["alt","Imagen ampliada del producto","class","full-size-image",3,"src",4,"ngIf"],["alt","Imagen ampliada del producto",1,"full-size-image",3,"src"]],template:function(n,i){1&n&&(e.j41(0,"ion-header",1)(1,"ion-toolbar")(2,"ion-buttons",2)(3,"ion-button",3),e.bIt("click",function(){return i.mostrarConfirmacionSalir()}),e.nrm(4,"ion-icon",4),e.k0s()(),e.j41(5,"ion-title"),e.EFF(6,"Editar Producto"),e.k0s(),e.j41(7,"ion-buttons",5)(8,"ion-button",6),e.bIt("click",function(){return i.guardarCambios()}),e.nrm(9,"ion-icon",7),e.k0s()()()(),e.j41(10,"ion-content",8),e.DNE(11,b,4,0,"div",9)(12,y,43,14,"div",10),e.j41(13,"ion-modal",11),e.bIt("ionModalDidDismiss",function(){return i.closeImageModal()}),e.DNE(14,F,10,1,"ng-template"),e.k0s()()),2&n&&(e.Y8G("translucent",!0),e.R7$(8),e.Y8G("disabled",i.isSaving),e.R7$(2),e.Y8G("fullscreen",!0),e.R7$(),e.Y8G("ngIf",i.isLoading),e.R7$(),e.Y8G("ngIf",!i.isLoading),e.R7$(),e.Y8G("isOpen",i.showImageModal))},dependencies:[h.bT,m.BC,m.YS,m.vS,r.Jm,r.QW,r.W9,r.eU,r.iq,r.$w,r.uz,r.he,r.nf,r.w2,r.nc,r.BC,r.ai,r.Sb,r.su,r.Gw,r.T6],encapsulation:2}),d})()}];let w=(()=>{var a;class d{}return(a=d).\u0275fac=function(n){return new(n||a)},a.\u0275mod=e.$C({type:a}),a.\u0275inj=e.G2t({imports:[v.iI.forChild(R),v.iI]}),d})(),T=(()=>{var a;class d{}return(a=d).\u0275fac=function(n){return new(n||a)},a.\u0275mod=e.$C({type:a}),a.\u0275inj=e.G2t({imports:[h.MD,m.YN,r.bv,w]}),d})()}}]);