(self.webpackChunkapp=self.webpackChunkapp||[]).push([[1849],{1849:(me,O,y)=>{"use strict";y.r(O),y.d(O,{PerfilPageModule:()=>le});var K=y(2881),J=y(4341),B=y(3092),Q=y(5207),j=y(467),ie=y(2614),Z=y.n(ie),N=y(9579),e=y(1360),ae=y(5032);const q=["inputFoto"],ne=["inputIdentificacion"];function T(m,_){if(1&m){const x=e.RV6();e.j41(0,"div",16),e.bIt("click",function(){e.eBV(x);const n=e.XpG();return e.Njj(n.mostrarExplicacionEstado())}),e.EFF(1," \u2714 "),e.k0s()}}function M(m,_){if(1&m){const x=e.RV6();e.j41(0,"div",17),e.bIt("click",function(){e.eBV(x);const n=e.XpG();return e.Njj(n.mostrarExplicacionEstado())}),e.EFF(1," \u2716 "),e.k0s()}}function oe(m,_){if(1&m){const x=e.RV6();e.qex(0,18),e.j41(1,"ion-item",19)(2,"ion-label",20),e.EFF(3,"Sube una identificaci\xf3n oficial o RFC"),e.k0s(),e.j41(4,"ion-button",10),e.bIt("click",function(){e.eBV(x);const n=e.XpG();return e.Njj(n.seleccionarIdentificacion())}),e.EFF(5,"Subir identificaci\xf3n"),e.k0s(),e.j41(6,"input",21,1),e.bIt("change",function(n){e.eBV(x);const u=e.XpG();return e.Njj(u.subirIdentificacion(n))}),e.k0s()(),e.j41(8,"ion-item",19)(9,"ion-button",10),e.bIt("click",function(){e.eBV(x);const n=e.XpG();return e.Njj(n.mostrarExplicacionIdentificacion())}),e.nrm(10,"ion-icon",22),e.k0s()(),e.bVm()}}const se=[{path:"",component:(()=>{var m;class _{constructor(l,n){this.navCtrl=l,this.alertCtrl=n,this.fotoURL=null,this.verificado=!1,this.vendedor=!1,this.mostrarAlerta=!1,this.usuario={nombre:"",telefono:"",direccion:""},this.mostrarAlertEditar=!1,this.alertButtonsEditar=[{text:"Cancelar",role:"cancel"},{text:"Guardar",handler:u=>u.nombre&&0!==u.nombre.trim().length?u.telefono&&!/^\d{10}$/.test(u.telefono)?(alert("El tel\xe9fono debe contener exactamente 10 d\xedgitos num\xe9ricos."),!1):(this.usuario.nombre=u.nombre.trim(),this.usuario.telefono=u.telefono,this.usuario.direccion=u.direccion,this.guardarDatos(),!0):(alert("El nombre es obligatorio."),!1)}],this.alertInputs=[{name:"nombre",type:"text",placeholder:"Nombre",value:"",attributes:{maxlength:50}},{name:"telefono",type:"tel",placeholder:"Tel\xe9fono",value:"",attributes:{maxlength:10,pattern:"[0-9]*",inputmode:"numeric"}},{name:"direccion",type:"text",placeholder:"Direcci\xf3n",value:""}],this.alertButtons=[{text:"Cancelar",role:"cancel"},{text:"Cerrar sesi\xf3n",handler:()=>this.logout()}]}ngOnInit(){this.cargarPerfil()}volver(){this.navCtrl.back()}cargarPerfil(){var l=this;return(0,j.A)(function*(){const n=localStorage.getItem("token");if(n)try{const u=yield fetch("https://backendalv.onrender.com/api/usuarios/me",{headers:{Authorization:`Bearer ${n}`}});if(!u.ok)throw new Error("Error al obtener perfil");const p=yield u.json();l.fotoURL=p.fotoPerfil||null,l.verificado=p.verificado||!1,l.vendedor=p.vendedor||!1,l.usuario.nombre=p.nombre||"",l.usuario.telefono=p.telefono||"",l.usuario.direccion=p.direccion||""}catch(u){console.error("Error cargando perfil:",u)}})()}guardarDatos(){var l=this;return(0,j.A)(function*(){const n=localStorage.getItem("token");if(n)try{const u=yield fetch("https://backendalv.onrender.com/api/usuarios",{method:"PUT",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"},body:JSON.stringify({nombre:l.usuario.nombre,telefono:l.usuario.telefono,direccion:l.usuario.direccion,vendedor:l.vendedor})}),p=yield u.json();if(!u.ok)return void alert("Error al guardar datos: "+(p.mensaje||""));alert("Datos guardados correctamente")}catch(u){console.error("Error guardando datos:",u),alert("Error al guardar datos")}})()}seleccionarImagen(){this.inputFoto.nativeElement.click()}subirImagen(l){var n=this;return(0,j.A)(function*(){const u=l.target;if(!u.files||0===u.files.length)return;const p=u.files[0];var R;new(Z())(p,{quality:.6,maxWidth:500,success:(R=(0,j.A)(function*(F){try{const D=localStorage.getItem("token");if(!D)return;const te=new FormData;te.append("file",F);const re=yield fetch("https://backendalv.onrender.com/api/usuarios/fotoPerfil",{method:"POST",headers:{Authorization:`Bearer ${D}`},body:te}),U=yield re.json();if(!re.ok)return void console.error("Error al subir la imagen:",U.mensaje||U);n.fotoURL=U.url}catch(D){console.error("Error al subir la imagen:",D)}}),function(D){return R.apply(this,arguments)}),error(R){console.error("Error al comprimir:",R.message)}})})()}seleccionarIdentificacion(){this.inputIdentificacion.nativeElement.click()}subirIdentificacion(l){return(0,j.A)(function*(){const n=l.target;if(!n.files||0===n.files.length)return;const u=n.files[0],p=localStorage.getItem("token");if(!p)return;const R=new FormData;R.append("file",u);try{const F=yield fetch("https://backendalv.onrender.com/api/usuarios/documento-verificacion",{method:"POST",headers:{Authorization:`Bearer ${p}`},body:R}),D=yield F.json();if(!F.ok)return void alert("Error al subir identificaci\xf3n: "+(D.mensaje||""));alert("Identificaci\xf3n enviada correctamente. Espera la validaci\xf3n.")}catch(F){console.error("Error al enviar la identificaci\xf3n:",F),alert("Error al subir identificaci\xf3n")}})()}mostrarAlertaCerrarSesion(){this.mostrarAlerta=!0}logout(){var l=this;return(0,j.A)(function*(){try{const n=(0,N.getAuth)();yield(0,N.signOut)(n),localStorage.removeItem("token"),localStorage.removeItem("correo"),localStorage.removeItem("contrasena"),l.navCtrl.navigateRoot("/login")}catch(n){console.error("Error al cerrar sesi\xf3n:",n)}})()}mostrarExplicacionEstado(){var l=this;return(0,j.A)(function*(){let n="";n=l.vendedor?l.verificado?"Como vendedor, tu cuenta est\xe1 verificada porque has subido un documento v\xe1lido y ha sido aprobado por el administrador.":"Como vendedor, tu cuenta no est\xe1 verificada. Por favor, sube una identificaci\xf3n oficial o RFC para validar tu cuenta y poder publicar productos.":l.verificado?"Tu cuenta est\xe1 verificada porque has subido un documento v\xe1lido y ha sido aprobado por el administrador.":"Tu cuenta no est\xe1 verificada. Por favor, sube una identificaci\xf3n oficial o RFC para validar tu cuenta.",yield(yield l.alertCtrl.create({header:"Estado de verificaci\xf3n",message:n,buttons:["OK"]})).present()})()}mostrarExplicacionIdentificacion(){var l=this;return(0,j.A)(function*(){yield(yield l.alertCtrl.create({header:"Validaci\xf3n de cuenta",message:"Al subir una identificaci\xf3n, tu cuenta ser\xe1 validada y tus productos ser\xe1n publicados en la plataforma.",buttons:["OK"]})).present()})()}abrirAlertEditarPerfil(){this.alertInputs=[{name:"nombre",type:"text",placeholder:"Nombre",value:this.usuario.nombre||"",attributes:{maxlength:50}},{name:"telefono",type:"tel",placeholder:"Tel\xe9fono",value:this.usuario.telefono||"",attributes:{maxlength:10,pattern:"[0-9]*",inputmode:"numeric"}},{name:"direccion",type:"text",placeholder:"Direcci\xf3n",value:this.usuario.direccion||""}],this.mostrarAlertEditar=!0}}return(m=_).\u0275fac=function(l){return new(l||m)(e.rXU(ae.q9),e.rXU(B.hG))},m.\u0275cmp=e.VBU({type:m,selectors:[["app-perfil"]],viewQuery:function(l,n){if(1&l&&(e.GBs(q,5),e.GBs(ne,5)),2&l){let u;e.mGM(u=e.lsd())&&(n.inputFoto=u.first),e.mGM(u=e.lsd())&&(n.inputIdentificacion=u.first)}},standalone:!1,decls:22,vars:11,consts:[["inputFoto",""],["inputIdentificacion",""],[3,"translucent"],["expand","block","color","medium","slot","start",3,"click"],[1,"ion-padding",3,"fullscreen"],[1,"ion-text-center",2,"position","relative","display","inline-block","margin-bottom","16px"],["alt","Foto de perfil",2,"width","150px","height","150px","border-radius","50%","object-fit","cover",3,"src"],["style","position: absolute; top: 5px; right: 5px; background-color: #4caf50; color: white; border-radius: 50%; padding: 5px; font-size: 16px; cursor: pointer;",3,"click",4,"ngIf"],["style","position: absolute; top: 5px; right: 5px; background-color: #f44336; color: white; border-radius: 50%; padding: 5px; font-size: 16px; cursor: pointer;",3,"click",4,"ngIf"],["style","margin-top: 24px;",4,"ngIf"],["expand","block",3,"click"],["type","file","hidden","","accept","image/*",3,"change"],["expand","block",2,"margin-top","24px",3,"click"],["expand","block","color","danger",2,"margin-top","24px",3,"click"],["header","Confirmar salida","message","\xbfDeseas cerrar sesi\xf3n?",3,"didDismiss","buttons","isOpen"],["header","Editar perfil",3,"didDismiss","isOpen","inputs","buttons"],[2,"position","absolute","top","5px","right","5px","background-color","#4caf50","color","white","border-radius","50%","padding","5px","font-size","16px","cursor","pointer",3,"click"],[2,"position","absolute","top","5px","right","5px","background-color","#f44336","color","white","border-radius","50%","padding","5px","font-size","16px","cursor","pointer",3,"click"],[2,"margin-top","24px"],["lines","none"],["position","stacked"],["type","file","hidden","","accept","image/*,.pdf",3,"change"],["name","information-circle-outline"]],template:function(l,n){if(1&l){const u=e.RV6();e.j41(0,"ion-header",2)(1,"ion-toolbar")(2,"ion-button",3),e.bIt("click",function(){return e.eBV(u),e.Njj(n.volver())}),e.EFF(3," Atr\xe1s "),e.k0s(),e.j41(4,"ion-title"),e.EFF(5,"Perfil"),e.k0s()()(),e.j41(6,"ion-content",4)(7,"div",5),e.nrm(8,"img",6),e.DNE(9,T,2,0,"div",7)(10,M,2,0,"div",8),e.k0s(),e.DNE(11,oe,11,0,"ng-container",9),e.j41(12,"ion-button",10),e.bIt("click",function(){return e.eBV(u),e.Njj(n.seleccionarImagen())}),e.EFF(13,"Cambiar foto"),e.k0s(),e.j41(14,"input",11,0),e.bIt("change",function(R){return e.eBV(u),e.Njj(n.subirImagen(R))}),e.k0s(),e.j41(16,"ion-button",12),e.bIt("click",function(){return e.eBV(u),e.Njj(n.abrirAlertEditarPerfil())}),e.EFF(17," Editar perfil "),e.k0s(),e.j41(18,"ion-button",13),e.bIt("click",function(){return e.eBV(u),e.Njj(n.mostrarAlertaCerrarSesion())}),e.EFF(19," Cerrar sesi\xf3n "),e.k0s(),e.j41(20,"ion-alert",14),e.bIt("didDismiss",function(){return e.eBV(u),e.Njj(n.mostrarAlerta=!1)}),e.k0s(),e.j41(21,"ion-alert",15),e.bIt("didDismiss",function(){return e.eBV(u),e.Njj(n.mostrarAlertEditar=!1)}),e.k0s()()}2&l&&(e.Y8G("translucent",!0),e.R7$(6),e.Y8G("fullscreen",!0),e.R7$(2),e.Y8G("src",n.fotoURL?n.fotoURL:"assets/img/placeholder-profile.png",e.B4B),e.R7$(),e.Y8G("ngIf",n.verificado),e.R7$(),e.Y8G("ngIf",!n.verificado),e.R7$(),e.Y8G("ngIf",!n.verificado),e.R7$(9),e.Y8G("buttons",n.alertButtons)("isOpen",n.mostrarAlerta),e.R7$(),e.Y8G("isOpen",n.mostrarAlertEditar)("inputs",n.alertInputs)("buttons",n.alertButtonsEditar))},dependencies:[K.bT,B.Zy,B.Jm,B.W9,B.eU,B.iq,B.uz,B.he,B.BC,B.ai],encapsulation:2}),_})()}];let z=(()=>{var m;class _{}return(m=_).\u0275fac=function(l){return new(l||m)},m.\u0275mod=e.$C({type:m}),m.\u0275inj=e.G2t({imports:[Q.iI.forChild(se),Q.iI]}),_})(),le=(()=>{var m;class _{}return(m=_).\u0275fac=function(l){return new(l||m)},m.\u0275mod=e.$C({type:m}),m.\u0275inj=e.G2t({imports:[K.MD,J.YN,B.bv,z]}),_})()},2614:function(me){me.exports=function(){"use strict";function O(a,t){var r=Object.keys(a);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(a);t&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(a,o).enumerable})),r.push.apply(r,i)}return r}function y(a){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?O(Object(r),!0).forEach(function(i){Q(a,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(r)):O(Object(r)).forEach(function(i){Object.defineProperty(a,i,Object.getOwnPropertyDescriptor(r,i))})}return a}function J(a,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(a,Z(i.key),i)}}function Q(a,t,r){return(t=Z(t))in a?Object.defineProperty(a,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):a[t]=r,a}function j(){return j=Object.assign?Object.assign.bind():function(a){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(a[i]=r[i])}return a},j.apply(this,arguments)}function Z(a){var t=function ie(a,t){if("object"!=typeof a||null===a)return a;var r=a[Symbol.toPrimitive];if(void 0!==r){var i=r.call(a,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(a)}(a,"string");return"symbol"==typeof t?t:String(t)}var a,t,r,i,o,s,g,h,N={exports:{}};a=N,typeof window>"u"||(t=window,r=t.HTMLCanvasElement&&t.HTMLCanvasElement.prototype,i=t.Blob&&function(){try{return!!new Blob}catch{return!1}}(),o=i&&t.Uint8Array&&function(){try{return 100===new Blob([new Uint8Array(100)]).size}catch{return!1}}(),s=t.BlobBuilder||t.WebKitBlobBuilder||t.MozBlobBuilder||t.MSBlobBuilder,g=/^data:((.*?)(;charset=.*?)?)(;base64)?,/,h=(i||s)&&t.atob&&t.ArrayBuffer&&t.Uint8Array&&function(f){var d,v,b,I,P,c,A,E,G;if(!(d=f.match(g)))throw new Error("invalid data URI");for(v=d[2]?d[1]:"text/plain"+(d[3]||";charset=US-ASCII"),b=!!d[4],I=f.slice(d[0].length),P=b?atob(I):decodeURIComponent(I),c=new ArrayBuffer(P.length),A=new Uint8Array(c),E=0;E<P.length;E+=1)A[E]=P.charCodeAt(E);return i?new Blob([o?A:c],{type:v}):((G=new s).append(c),G.getBlob(v))},t.HTMLCanvasElement&&!r.toBlob&&(r.mozGetAsFile?r.toBlob=function(f,d,v){var b=this;setTimeout(function(){f(v&&r.toDataURL&&h?h(b.toDataURL(d,v)):b.mozGetAsFile("blob",d))})}:r.toDataURL&&h&&(r.toBlob=r.msToBlob?function(f,d,v){var b=this;setTimeout(function(){f((d&&"image/png"!==d||v)&&r.toDataURL&&h?h(b.toDataURL(d,v)):b.msToBlob(d))})}:function(f,d,v){var b=this;setTimeout(function(){f(h(b.toDataURL(d,v)))})})),a.exports?a.exports=h:t.dataURLtoBlob=h);var e=N.exports,q={strict:!0,checkOrientation:!0,retainExif:!1,maxWidth:1/0,maxHeight:1/0,minWidth:0,minHeight:0,width:void 0,height:void 0,resize:"none",quality:.8,mimeType:"auto",convertTypes:["image/png"],convertSize:5e6,beforeDraw:null,drew:null,success:null,error:null},T=typeof window<"u"&&typeof window.document<"u"?window:{},M=function(t){return t>0&&t<1/0},oe=Array.prototype.slice;function ee(a){return Array.from?Array.from(a):oe.call(a)}var se=/^image\/.+$/;function z(a){return se.test(a)}var m=String.fromCharCode;var x=T.btoa;function l(a,t){for(var r=[],o=new Uint8Array(a);o.length>0;)r.push(m.apply(null,ee(o.subarray(0,8192)))),o=o.subarray(8192);return"data:".concat(t,";base64,").concat(x(r.join("")))}function n(a){var r,t=new DataView(a);try{var i,o,s;if(255===t.getUint8(0)&&216===t.getUint8(1))for(var g=t.byteLength,h=2;h+1<g;){if(255===t.getUint8(h)&&225===t.getUint8(h+1)){o=h;break}h+=1}if(o){var d=o+10;if("Exif"===function _(a,t,r){var o,i="";for(r+=t,o=t;o<r;o+=1)i+=m(a.getUint8(o));return i}(t,o+4,4)){var v=t.getUint16(d);if(((i=18761===v)||19789===v)&&42===t.getUint16(d+2,i)){var b=t.getUint32(d+4,i);b>=8&&(s=d+b)}}}if(s){var P,c,I=t.getUint16(s,i);for(c=0;c<I;c+=1)if(274===t.getUint16(P=s+12*c+2,i)){r=t.getUint16(P+=8,i),t.setUint16(P,1,i);break}}}catch{r=1}return r}var p=/\.\d*(?:0|9){12}\d*$/;function R(a){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e11;return p.test(a)?Math.round(a*t)/t:a}function F(a){var t=a.aspectRatio,r=a.height,i=a.width,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none",s=M(i),g=M(r);if(s&&g){var h=r*t;("contain"===o||"none"===o)&&h>i||"cover"===o&&h<i?r=i/t:i=r*t}else s?r=i/t:g&&(i=r*t);return{width:i,height:r}}var re=T.ArrayBuffer,U=T.FileReader,C=T.URL||T.webkitURL,De=/\.\w+$/,Ue=T.Compressor,Ce=function(){function a(t,r){(function K(a,t){if(!(a instanceof t))throw new TypeError("Cannot call a class as a function")})(this,a),this.file=t,this.exif=[],this.image=new Image,this.options=y(y({},q),r),this.aborted=!1,this.result=null,this.init()}return function B(a,t,r){return t&&J(a.prototype,t),r&&J(a,r),Object.defineProperty(a,"prototype",{writable:!1}),a}(a,[{key:"init",value:function(){var r=this,i=this.file,o=this.options;if(function(t){return!(typeof Blob>"u")&&(t instanceof Blob||"[object Blob]"===Object.prototype.toString.call(t))}(i)){var s=i.type;if(z(s))if(C&&U){re||(o.checkOrientation=!1,o.retainExif=!1);var g="image/jpeg"===s,h=g&&o.checkOrientation,f=g&&o.retainExif;if(!C||h||f){var d=new U;this.reader=d,d.onload=function(v){var I=v.target.result,P={},c=1;h&&(c=n(I))>1&&j(P,function u(a){var t=0,r=1,i=1;switch(a){case 2:r=-1;break;case 3:t=-180;break;case 4:i=-1;break;case 5:t=90,i=-1;break;case 6:t=90;break;case 7:t=90,r=-1;break;case 8:t=-90}return{rotate:t,scaleX:r,scaleY:i}}(c)),f&&(r.exif=function D(a){for(var t=ee(new Uint8Array(a)),r=t.length,i=[],o=0;o+3<r;){var s=t[o],g=t[o+1];if(255===s&&218===g)break;if(255===s&&216===g)o+=2;else{var f=o+(256*t[o+2]+t[o+3])+2,d=t.slice(o,f);i.push(d),o=f}}return i.reduce(function(v,b){return 255===b[0]&&225===b[1]?v.concat(b):v},[])}(I)),P.url=h||f?!C||c>1?l(I,s):C.createObjectURL(i):I,r.load(P)},d.onabort=function(){r.fail(new Error("Aborted to read the image with FileReader."))},d.onerror=function(){r.fail(new Error("Failed to read the image with FileReader."))},d.onloadend=function(){r.reader=null},h||f?d.readAsArrayBuffer(i):d.readAsDataURL(i)}else this.load({url:C.createObjectURL(i)})}else this.fail(new Error("The current browser does not support image compression."));else this.fail(new Error("The first argument must be an image File or Blob object."))}else this.fail(new Error("The first argument must be a File or Blob object."))}},{key:"load",value:function(r){var i=this,o=this.file,s=this.image;s.onload=function(){i.draw(y(y({},r),{},{naturalWidth:s.naturalWidth,naturalHeight:s.naturalHeight}))},s.onabort=function(){i.fail(new Error("Aborted to load the image."))},s.onerror=function(){i.fail(new Error("Failed to load the image."))},T.navigator&&/(?:iPad|iPhone|iPod).*?AppleWebKit/i.test(T.navigator.userAgent)&&(s.crossOrigin="anonymous"),s.alt=o.name,s.src=r.url}},{key:"draw",value:function(r){var i=this,o=r.naturalWidth,s=r.naturalHeight,g=r.rotate,h=void 0===g?0:g,f=r.scaleX,d=void 0===f?1:f,v=r.scaleY,b=void 0===v?1:v,I=this.file,P=this.image,c=this.options,A=document.createElement("canvas"),E=A.getContext("2d"),G=Math.abs(h)%180==90,ce=("contain"===c.resize||"cover"===c.resize)&&M(c.width)&&M(c.height),V=Math.max(c.maxWidth,0)||1/0,W=Math.max(c.maxHeight,0)||1/0,$=Math.max(c.minWidth,0)||0,H=Math.max(c.minHeight,0)||0,S=o/s,k=c.width,w=c.height;if(G){var pe=[W,V];V=pe[0],W=pe[1];var ge=[H,$];$=ge[0],H=ge[1];var ve=[w,k];k=ve[0],w=ve[1]}ce&&(S=k/w);var be=F({aspectRatio:S,width:V,height:W},"contain");V=be.width,W=be.height;var ye=F({aspectRatio:S,width:$,height:H},"cover");if($=ye.width,H=ye.height,ce){var Pe=F({aspectRatio:S,width:k,height:w},c.resize);k=Pe.width,w=Pe.height}else{var xe=F({aspectRatio:S,width:k,height:w}),Ee=xe.width;k=void 0===Ee?o:Ee;var ke=xe.height;w=void 0===ke?s:ke}var Oe=-(k=Math.floor(R(Math.min(Math.max(k,$),V))))/2,Me=-(w=Math.floor(R(Math.min(Math.max(w,H),W))))/2,Ge=k,Se=w,ue=[];if(ce){var fe,de,je=F({aspectRatio:S,width:o,height:s},{contain:"cover",cover:"contain"}[c.resize]);ue.push((o-(fe=je.width))/2,(s-(de=je.height))/2,fe,de)}if(ue.push(Oe,Me,Ge,Se),G){var _e=[w,k];k=_e[0],w=_e[1]}A.width=k,A.height=w,z(c.mimeType)||(c.mimeType=I.type);var Fe="transparent";I.size>c.convertSize&&c.convertTypes.indexOf(c.mimeType)>=0&&(c.mimeType="image/jpeg");var Ie="image/jpeg"===c.mimeType;if(Ie&&(Fe="#fff"),E.fillStyle=Fe,E.fillRect(0,0,k,w),c.beforeDraw&&c.beforeDraw.call(this,E,A),!this.aborted&&(E.save(),E.translate(k/2,w/2),E.rotate(h*Math.PI/180),E.scale(d,b),E.drawImage.apply(E,[P].concat(ue)),E.restore(),c.drew&&c.drew.call(this,E,A),!this.aborted)){var Ae=function(X){if(!i.aborted){var Re=function(Y){return i.done({naturalWidth:o,naturalHeight:s,result:Y})};if(X&&Ie&&c.retainExif&&i.exif&&i.exif.length>0){var Te=function(Y){return Re(e(l(function te(a,t){var r=ee(new Uint8Array(a));if(255!==r[2]||224!==r[3])return a;var o=[255,216].concat(t,r.slice(4+(256*r[4]+r[5])));return new Uint8Array(o)}(Y,i.exif),c.mimeType)))};if(X.arrayBuffer)X.arrayBuffer().then(Te).catch(function(){i.fail(new Error("Failed to read the compressed image with Blob.arrayBuffer()."))});else{var L=new U;i.reader=L,L.onload=function(he){Te(he.target.result)},L.onabort=function(){i.fail(new Error("Aborted to read the compressed image with FileReader."))},L.onerror=function(){i.fail(new Error("Failed to read the compressed image with FileReader."))},L.onloadend=function(){i.reader=null},L.readAsArrayBuffer(X)}}else Re(X)}};A.toBlob?A.toBlob(Ae,c.mimeType,c.quality):Ae(e(A.toDataURL(c.mimeType,c.quality)))}}},{key:"done",value:function(r){var i=r.naturalWidth,o=r.naturalHeight,s=r.result,g=this.file,h=this.image,f=this.options;if(C&&0===h.src.indexOf("blob:")&&C.revokeObjectURL(h.src),s)if(f.strict&&!f.retainExif&&s.size>g.size&&f.mimeType===g.type&&!(f.width>i||f.height>o||f.minWidth>i||f.minHeight>o||f.maxWidth<i||f.maxHeight<o))s=g;else{var d=new Date;s.lastModified=d.getTime(),s.lastModifiedDate=d,s.name=g.name,s.name&&s.type!==g.type&&(s.name=s.name.replace(De,function le(a){var t=z(a)?a.substr(6):"";return"jpeg"===t&&(t="jpg"),".".concat(t)}(s.type)))}else s=g;this.result=s,f.success&&f.success.call(this,s)}},{key:"fail",value:function(r){var i=this.options;if(!i.error)throw r;i.error.call(this,r)}},{key:"abort",value:function(){this.aborted||(this.aborted=!0,this.reader?this.reader.abort():this.image.complete?this.fail(new Error("The compression process has been aborted.")):(this.image.onload=null,this.image.onabort()))}}],[{key:"noConflict",value:function(){return window.Compressor=Ue,a}},{key:"setDefaults",value:function(r){j(q,r)}}]),a}();return Ce}()}}]);