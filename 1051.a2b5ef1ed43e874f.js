"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[1051],{1051:(j,v,s)=>{s.r(v),s.d(v,{MetodoPageModule:()=>F});var u=s(2881),p=s(4341),l=s(3092),m=s(5207),P=s(467),h=s(9579),o=s(1360),M=s(5032),f=s(7664),y=s(8198);const C=[{path:"",component:(()=>{var n;class d{constructor(e,t,r,i){this.alertCtrl=e,this.router=t,this.pedirService=r,this.navCtrl=i,this.totalBase=0,this.gananciaPorcentaje=.1,this.totalConGanancia=0,this.metodoPago="",this.procesandoPago=!1}ngOnInit(){var e,t;const r=this.pedirService.getProductos();if(console.log("\u{1f50d} MetodoPage - Productos DE PedirService:",r),console.log("\u{1f4e7} Primer vendedor:",null===(e=r[0])||void 0===e?void 0:e.vendedor),console.log("\xbfEs email?",null===(t=r[0])||void 0===t||null===(t=t.vendedor)||void 0===t?void 0:t.includes("@")),0===r.length)return console.error("\u274c ERROR: PedirService est\xe1 vac\xedo en MetodoPage"),void this.navCtrl.navigateRoot("/carrito");this.metodoPago=this.pedirService.getMetodoPago(),this.calcularTotales()}calcularTotales(){const e=this.pedirService.getProductos();this.totalBase=e.reduce((t,r)=>t+r.precio*r.cantidad,0),this.totalConGanancia=this.totalBase*(1+this.gananciaPorcentaje)}confirmarPago(){var e=this;return(0,P.A)(function*(){if(e.procesandoPago)return void console.log("\u26a0\ufe0f Pago ya en proceso, ignorando pulsaci\xf3n...");if(!e.metodoPago)return console.log("\u26a0\ufe0f M\xe9todo de pago no seleccionado"),void(yield(yield e.alertCtrl.create({header:"Selecciona un m\xe9todo de pago",buttons:["OK"]})).present());e.procesandoPago=!0,e.pedirService.setMetodoPago(e.metodoPago);const r=(0,h.getAuth)().currentUser;if(!r)return console.log("\u274c Usuario no autenticado"),e.procesandoPago=!1,void(yield(yield e.alertCtrl.create({header:"Error",message:"Debes iniciar sesi\xf3n para continuar.",buttons:["OK"]})).present());try{console.log("\u{1f504} Iniciando proceso de compra..."),console.log("\u{1f464} Usuario ID:",r.uid),console.log("\u{1f4b0} Total base:",e.totalBase),console.log("\u{1f4b0} Total con ganancia:",e.totalConGanancia),console.log("\u{1f4b3} M\xe9todo de pago:",e.metodoPago);const a=e.pedirService.getProductos();console.log("\u{1f6d2} Productos en carrito:",JSON.stringify(a,null,2)),console.log("\u{1f4e4} Enviando pedido al backend..."),yield e.pedirService.enviarPedido(),console.log("\u2705 Pedido enviado correctamente."),e.procesandoPago=!1,yield(yield e.alertCtrl.create({header:"Pago confirmado",message:`Has pagado $${e.totalConGanancia.toFixed(2)} con ${e.metodoPago}. \xa1Gracias por tu compra!`,buttons:[{text:"Aceptar",handler:()=>{console.log("\u{1f3e0} Navegando al hub..."),e.router.navigate(["/hub"])}}]})).present()}catch(a){var i;e.procesandoPago=!1,console.error("\u274c Error procesando pago:",a),console.log("\u{1f50d} Detalles del error:"),console.log("- Status:",null==a?void 0:a.status),console.log("- Status text:",null==a?void 0:a.statusText),console.log("- URL:",null==a?void 0:a.url),console.log("- Headers:",null==a?void 0:a.headers),console.log("- Error object:",null==a?void 0:a.error);let g="Hubo un problema al procesar tu pago. Int\xe9ntalo de nuevo.";null!=a&&a.message?g=a.message:null!=a&&null!==(i=a.error)&&void 0!==i&&i.message?g=a.error.message:null!=a&&a.error&&(g=JSON.stringify(a.error)),yield(yield e.alertCtrl.create({header:"Error",message:g,buttons:["OK"]})).present()}})()}volver(){this.navCtrl.navigateBack("pago/datos")}}return(n=d).\u0275fac=function(e){return new(e||n)(o.rXU(l.hG),o.rXU(f.Ix),o.rXU(y.O),o.rXU(M.q9))},n.\u0275cmp=o.VBU({type:n,selectors:[["app-metodo"]],standalone:!1,decls:31,vars:17,consts:[[3,"translucent"],["expand","block","color","medium","slot","start",3,"click"],[1,"ion-padding"],[3,"ngModelChange","ngModel"],["slot","start","value","efectivo"],["slot","start","value","tarjeta"],["expand","block","color","primary",3,"click","disabled"]],template:function(e,t){1&e&&(o.j41(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-button",1),o.bIt("click",function(){return t.volver()}),o.EFF(3," Atr\xe1s "),o.k0s(),o.j41(4,"ion-title"),o.EFF(5,"Metodo de pago"),o.k0s()()(),o.j41(6,"ion-content",2)(7,"p"),o.EFF(8),o.nI1(9,"currency"),o.k0s(),o.j41(10,"p"),o.EFF(11),o.nI1(12,"number"),o.nI1(13,"currency"),o.k0s(),o.j41(14,"h2"),o.EFF(15),o.nI1(16,"currency"),o.k0s(),o.j41(17,"ion-radio-group",3),o.mxI("ngModelChange",function(i){return o.DH7(t.metodoPago,i)||(t.metodoPago=i),i}),o.j41(18,"ion-list-header")(19,"ion-label"),o.EFF(20,"Selecciona m\xe9todo de pago"),o.k0s()(),o.j41(21,"ion-item")(22,"ion-label"),o.EFF(23,"Efectivo"),o.k0s(),o.nrm(24,"ion-radio",4),o.k0s(),o.j41(25,"ion-item")(26,"ion-label"),o.EFF(27,"Tarjeta"),o.k0s(),o.nrm(28,"ion-radio",5),o.k0s()(),o.j41(29,"ion-button",6),o.bIt("click",function(){return t.confirmarPago()}),o.EFF(30),o.k0s()()),2&e&&(o.Y8G("translucent",!0),o.R7$(8),o.SpI("Total base: ",o.bMT(9,8,t.totalBase),""),o.R7$(3),o.Lme("Ganancia (",o.i5U(12,10,100*t.gananciaPorcentaje,"1.0-0"),"%): ",o.bMT(13,13,t.totalBase*t.gananciaPorcentaje),""),o.R7$(4),o.SpI("Total a pagar: ",o.bMT(16,15,t.totalConGanancia),""),o.R7$(2),o.R50("ngModel",t.metodoPago),o.R7$(12),o.Y8G("disabled",t.procesandoPago),o.R7$(),o.SpI(" ",t.procesandoPago?"Procesando...":"Confirmar Pago","\n"))},dependencies:[p.BC,p.vS,l.Jm,l.W9,l.eU,l.uz,l.he,l.AF,l.KO,l.f0,l.BC,l.ai,l.Je,u.QX,u.oe],encapsulation:2}),d})()}];let b=(()=>{var n;class d{}return(n=d).\u0275fac=function(e){return new(e||n)},n.\u0275mod=o.$C({type:n}),n.\u0275inj=o.G2t({imports:[m.iI.forChild(C),m.iI]}),d})(),F=(()=>{var n;class d{}return(n=d).\u0275fac=function(e){return new(e||n)},n.\u0275mod=o.$C({type:n}),n.\u0275inj=o.G2t({imports:[u.MD,p.YN,l.bv,b]}),d})()}}]);