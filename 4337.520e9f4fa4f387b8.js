"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[4337],{4337:(S,f,c)=>{c.r(f),c.d(f,{InventarioPageModule:()=>R});var p=c(2881),b=c(4341),i=c(3092),h=c(5207),v=c(467),d=c(7643),g=c(5312),e=c(1360),P=c(5032),I=c(4796);let _=(()=>{var t;class a{constructor(o){this.http=o}getHeaders(){const o=localStorage.getItem("token");return new d.Lr({Authorization:`Bearer ${o}`,"Content-Type":"application/json"})}getMisPedidos(){const o=this.getHeaders();return this.http.get(`${g.c.apiUrl}/api/pedidos/mis-pedidos`,{headers:o})}contarPedidos(){const o=localStorage.getItem("token"),n=(new d.Lr).set("Authorization",`Bearer ${o}`);return this.http.get(`${g.c.apiUrl}/api/pedidos/contar`,{headers:n})}}return(t=a).\u0275fac=function(o){return new(o||t)(e.KVO(d.Qq))},t.\u0275prov=e.jDH({token:t,factory:t.\u0275fac,providedIn:"root"}),a})();function k(t,a){if(1&t&&(e.j41(0,"ion-badge",18),e.EFF(1),e.k0s()),2&t){const r=e.XpG();e.R7$(),e.SpI(" ",r.pedidosPendientes>99?"99+":r.pedidosPendientes," ")}}function x(t,a){if(1&t&&(e.j41(0,"ion-badge",19),e.EFF(1),e.k0s()),2&t){const r=e.XpG();e.R7$(),e.SpI(" ",r.pedidosPendientes>99?"99+":r.pedidosPendientes," ")}}function F(t,a){if(1&t){const r=e.RV6();e.j41(0,"ion-button",20),e.bIt("click",function(){e.eBV(r);const n=e.XpG();return e.Njj(n.iragregar())}),e.EFF(1,"Agregar productos"),e.k0s()}}function C(t,a){1&t&&(e.j41(0,"ion-badge",27),e.EFF(1," Agotado "),e.k0s())}function j(t,a){if(1&t){const r=e.RV6();e.j41(0,"ion-col",21)(1,"ion-card")(2,"ion-card-header")(3,"ion-card-title"),e.EFF(4),e.DNE(5,C,2,0,"ion-badge",22),e.k0s(),e.j41(6,"ion-card-subtitle"),e.EFF(7),e.k0s()(),e.j41(8,"ion-card-content"),e.EFF(9),e.nI1(10,"number"),e.k0s(),e.j41(11,"ion-button",23),e.bIt("click",function(){const n=e.eBV(r).$implicit,s=e.XpG();return e.Njj(s.editarProducto(n))}),e.nrm(12,"ion-icon",24),e.EFF(13),e.k0s(),e.j41(14,"ion-button",25),e.bIt("click",function(){const n=e.eBV(r).$implicit,s=e.XpG();return e.Njj(s.borrarProducto(n._id))}),e.nrm(15,"ion-icon",26),e.EFF(16," Borrar "),e.k0s()()()}if(2&t){const r=a.$implicit;e.R7$(),e.AVh("sin-stock",0===r.cantidad),e.R7$(3),e.SpI(" ",r.nombre," "),e.R7$(),e.Y8G("ngIf",0===r.cantidad),e.R7$(2),e.SpI("Cantidad: ",r.cantidad,""),e.R7$(2),e.SpI(" Precio: $",e.i5U(10,7,r.precio,"1.2-2")," "),e.R7$(4),e.SpI(" ",0===r.cantidad?"Agregar m\xe1s":"Editar"," ")}}function E(t,a){if(1&t){const r=e.RV6();e.j41(0,"div",28)(1,"p"),e.EFF(2,"No tienes productos a\xfan. Agrega algunos."),e.k0s(),e.j41(3,"ion-button",29),e.bIt("click",function(){e.eBV(r);const n=e.XpG();return e.Njj(n.iragregar())}),e.EFF(4,"Agregar productos"),e.k0s()()}}const y=[{path:"",component:(()=>{var t;class a{constructor(o,n,s,m,u){this.navCtrl=o,this.http=n,this.authService=s,this.alertController=m,this.pedidosService=u,this.productos=[],this.fotoURL="",this.pedidosCount=0,this.pedidosPendientes=0}ngOnInit(){this.cargarInventario(),this.cargarFotoPerfil(),this.cargarContadorPedidos(),this.intervalId=setInterval(()=>{this.cargarContadorPedidos()},1e4)}ionViewWillEnter(){this.cargarContadorPedidos()}ngOnDestroy(){this.intervalId&&clearInterval(this.intervalId)}cargarInventario(){const o=this.authService.getToken();if(!o)return void alert("Debes iniciar sesi\xf3n");const n=(new d.Lr).set("Authorization",`Bearer ${o}`);this.http.get(`${g.c.apiUrl}/api/inventario`,{headers:n}).subscribe({next:s=>{this.productos=s},error:s=>{console.error("Error al cargar inventario:",s)}})}cargarFotoPerfil(){var o=this;return(0,v.A)(function*(){try{const n=yield o.authService.fetchUserProfile();o.fotoURL=n.fotoPerfil||""}catch(n){console.error("Error al cargar la foto de perfil:",n)}})()}borrarProducto(o){var n=this;return(0,v.A)(function*(){const s=n.authService.getToken();s?yield(yield n.alertController.create({header:"Eliminar producto",message:"\xbfEst\xe1s seguro de que deseas eliminar este producto? Esta acci\xf3n no se puede deshacer.",buttons:[{text:"Cancelar",role:"cancel"},{text:"Eliminar",role:"destructive",handler:()=>{const u=(new d.Lr).set("Authorization",`Bearer ${s}`);n.http.delete(`${g.c.apiUrl}/api/inventario/${o}`,{headers:u}).subscribe({next:()=>{n.productos=n.productos.filter(l=>l._id!==o),n.alertController.create({header:"Eliminado",message:"El producto fue eliminado correctamente.",buttons:["OK"]}).then(l=>l.present())},error:l=>{console.error("Error al eliminar producto:",l),n.alertController.create({header:"Error",message:"No se pudo eliminar el producto.",buttons:["OK"]}).then(M=>M.present())}})}}]})).present():yield(yield n.alertController.create({header:"Sesi\xf3n requerida",message:"Debes iniciar sesi\xf3n para realizar esta acci\xf3n.",buttons:["OK"]})).present()})()}editarProducto(o){this.navCtrl.navigateForward(`/editar/${o._id}`)}sinStock(o){return 0===o.cantidad}iragregar(){this.navCtrl.navigateForward("/agregar")}perfil(){this.navCtrl.navigateForward("/perfil")}irPedidos(){this.navCtrl.navigateForward("/pedidos")}cargarContadorPedidos(){this.authService.getToken()&&this.pedidosService.contarPedidos().subscribe({next:n=>{this.pedidosCount=n.total,this.pedidosPendientes=n.pendientes},error:n=>{console.error("Error al contar pedidos:",n),this.pedidosCount=0,this.pedidosPendientes=0}})}}return(t=a).\u0275fac=function(o){return new(o||t)(e.rXU(P.q9),e.rXU(d.Qq),e.rXU(I.u),e.rXU(i.hG),e.rXU(_))},t.\u0275cmp=e.VBU({type:t,selectors:[["app-inventario"]],standalone:!1,decls:28,vars:8,consts:[["contentId","main-content","side","start","menuId","filters","type","overlay"],["color","primary",1,"ion-text-center"],["fill","clear",2,"margin","10px auto","display","block",3,"click"],["alt","Perfil",2,"width","80px","height","80px","border-radius","50%","object-fit","cover",3,"src"],["button","",1,"pedidos-item",3,"click"],["slot","start","name","list-outline"],["color","danger","slot","end","class","pedidos-badge",4,"ngIf"],[3,"translucent"],["slot","start"],[1,"menu-button-container",2,"position","relative"],["autoHide","false"],["color","danger","style","\n            position: absolute;\n            top: -4px;\n            right: -4px;\n            font-size: 0.7rem;\n            padding: 2px 6px;\n            border-radius: 10px;\n          ",4,"ngIf"],["id","main-content","scroll-y","false",1,"ion-padding",3,"fullscreen"],[1,"barra-fija"],["expand","block",3,"click",4,"ngIf"],[1,"productos-scrollable",2,"height","calc(100vh - 56px - var(--ion-safe-area-top) - 32px)","overflow-y","auto","padding","16px","padding-bottom","48px"],["size","6","class","ion-padding",4,"ngFor","ngForOf"],["class","ion-text-center",4,"ngIf"],["color","danger","slot","end",1,"pedidos-badge"],["color","danger",2,"position","absolute","top","-4px","right","-4px","font-size","0.7rem","padding","2px 6px","border-radius","10px"],["expand","block",3,"click"],["size","6",1,"ion-padding"],["color","danger","style","margin-left: 8px;",4,"ngIf"],["fill","clear","color","primary",3,"click"],["name","create-outline","slot","start"],["fill","clear","color","danger",3,"click"],["name","trash-outline","slot","start"],["color","danger",2,"margin-left","8px"],[1,"ion-text-center"],[3,"click"]],template:function(o,n){1&o&&(e.j41(0,"ion-menu",0)(1,"ion-header")(2,"ion-toolbar",1)(3,"ion-button",2),e.bIt("click",function(){return n.perfil()}),e.nrm(4,"img",3),e.k0s()()(),e.j41(5,"ion-content")(6,"ion-list")(7,"ion-item",4),e.bIt("click",function(){return n.irPedidos()}),e.nrm(8,"ion-icon",5),e.j41(9,"ion-label"),e.EFF(10,"Mis pedidos"),e.k0s(),e.DNE(11,k,2,1,"ion-badge",6),e.k0s()()()(),e.j41(12,"ion-header",7)(13,"ion-toolbar")(14,"ion-buttons",8)(15,"div",9),e.nrm(16,"ion-menu-button",10),e.DNE(17,x,2,1,"ion-badge",11),e.k0s()(),e.j41(18,"ion-title"),e.EFF(19,"Inventario"),e.k0s()()(),e.j41(20,"ion-content",12)(21,"div",13),e.DNE(22,F,2,0,"ion-button",14),e.k0s(),e.j41(23,"div",15)(24,"ion-grid")(25,"ion-row"),e.DNE(26,j,17,10,"ion-col",16),e.k0s()(),e.DNE(27,E,5,0,"div",17),e.k0s()()),2&o&&(e.R7$(4),e.Y8G("src",n.fotoURL?n.fotoURL:"assets/img/placeholder-profile.png",e.B4B),e.R7$(7),e.Y8G("ngIf",n.pedidosPendientes>0),e.R7$(),e.Y8G("translucent",!0),e.R7$(5),e.Y8G("ngIf",n.pedidosPendientes>0),e.R7$(3),e.Y8G("fullscreen",!0),e.R7$(2),e.Y8G("ngIf",n.productos.length>0),e.R7$(4),e.Y8G("ngForOf",n.productos),e.R7$(),e.Y8G("ngIf",0===n.productos.length))},dependencies:[p.Sq,p.bT,i.In,i.Jm,i.QW,i.b_,i.I9,i.ME,i.HW,i.tN,i.hU,i.W9,i.lO,i.eU,i.iq,i.uz,i.he,i.nf,i.oS,i.MC,i.ln,i.BC,i.ai,p.QX],styles:['@charset "UTF-8";.barra-fija[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:0 16px;height:56px;background:var(--ion-color-light);position:sticky;top:0;z-index:10;border-bottom:1px solid var(--ion-color-medium)}.barra-fija[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{flex:1;margin:0;--background: transparent}.barra-fija[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{max-width:180px;margin-left:16px}.productos-scrollable[_ngcontent-%COMP%]{height:calc(100vh - 56px - var(--ion-safe-area-top) - 32px);overflow-y:auto;padding:16px 16px 48px}ion-row[_ngcontent-%COMP%]{margin:0;--ion-padding-start: 0;--ion-padding-end: 0}.alert-btn-rojo[_ngcontent-%COMP%]{--color: #d32f2f !important;font-weight:700}.sin-stock[_ngcontent-%COMP%]{opacity:.6;filter:grayscale(50%)}.menu-button-container[_ngcontent-%COMP%]{position:relative}.menu-button-container[_ngcontent-%COMP%]   ion-badge[_ngcontent-%COMP%]{position:absolute;top:-4px;right:-4px;font-size:.7rem;padding:2px 6px;border-radius:10px}']}),a})()}];let $=(()=>{var t;class a{}return(t=a).\u0275fac=function(o){return new(o||t)},t.\u0275mod=e.$C({type:t}),t.\u0275inj=e.G2t({imports:[h.iI.forChild(y),h.iI]}),a})(),R=(()=>{var t;class a{}return(t=a).\u0275fac=function(o){return new(o||t)},t.\u0275mod=e.$C({type:t}),t.\u0275inj=e.G2t({imports:[p.MD,b.YN,i.bv,$]}),a})()}}]);