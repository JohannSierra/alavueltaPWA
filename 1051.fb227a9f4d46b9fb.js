"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[1051],{1051:(j,m,i)=>{i.r(m),i.d(m,{MetodoPageModule:()=>b});var g=i(2881),p=i(4341),r=i(3092),P=i(5207),h=i(467),v=i(9579),o=i(1360),M=i(5032),f=i(7664),C=i(8198);const F=[{path:"",component:(()=>{var t;class l{constructor(e,a,d,s){this.alertCtrl=e,this.router=a,this.pedirService=d,this.navCtrl=s,this.totalBase=0,this.gananciaPorcentaje=.1,this.totalConGanancia=0,this.metodoPago="",this.procesandoPago=!1}ngOnInit(){0!==this.pedirService.getProductos().length?(this.metodoPago=this.pedirService.getMetodoPago(),this.calcularTotales()):this.navCtrl.navigateRoot("/carrito")}calcularTotales(){const e=this.pedirService.getProductos();this.totalBase=e.reduce((a,d)=>a+d.precio*d.cantidad,0),this.totalConGanancia=this.totalBase*(1+this.gananciaPorcentaje)}confirmarPago(){var e=this;return(0,h.A)(function*(){if(!e.procesandoPago)if(e.metodoPago){if(e.procesandoPago=!0,e.pedirService.setMetodoPago(e.metodoPago),!(0,v.getAuth)().currentUser)return e.procesandoPago=!1,void(yield(yield e.alertCtrl.create({header:"Error",message:"Debes iniciar sesi\xf3n para continuar.",buttons:["OK"]})).present());try{e.pedirService.getProductos(),yield e.pedirService.enviarPedido(),e.procesandoPago=!1,yield(yield e.alertCtrl.create({header:"Pago confirmado",message:`Has pagado $${e.totalConGanancia.toFixed(2)} con ${e.metodoPago}. \xa1Gracias por tu compra!`,buttons:[{text:"Aceptar",handler:()=>{e.router.navigate(["/hub"])}}]})).present()}catch(n){var s;e.procesandoPago=!1;let u="Hubo un problema al procesar tu pago. Int\xe9ntalo de nuevo.";null!=n&&n.message?u=n.message:null!=n&&null!==(s=n.error)&&void 0!==s&&s.message?u=n.error.message:null!=n&&n.error&&(u=JSON.stringify(n.error)),yield(yield e.alertCtrl.create({header:"Error",message:u,buttons:["OK"]})).present()}}else yield(yield e.alertCtrl.create({header:"Selecciona un m\xe9todo de pago",buttons:["OK"]})).present()})()}volver(){this.navCtrl.navigateBack("pago/datos")}}return(t=l).\u0275fac=function(e){return new(e||t)(o.rXU(r.hG),o.rXU(f.Ix),o.rXU(C.O),o.rXU(M.q9))},t.\u0275cmp=o.VBU({type:t,selectors:[["app-metodo"]],standalone:!1,decls:31,vars:17,consts:[[3,"translucent"],["expand","block","color","medium","slot","start",3,"click"],[1,"ion-padding"],[3,"ngModelChange","ngModel"],["slot","start","value","efectivo"],["slot","start","value","tarjeta"],["expand","block","color","primary",3,"click","disabled"]],template:function(e,a){1&e&&(o.j41(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-button",1),o.bIt("click",function(){return a.volver()}),o.EFF(3," Atr\xe1s "),o.k0s(),o.j41(4,"ion-title"),o.EFF(5,"Metodo de pago"),o.k0s()()(),o.j41(6,"ion-content",2)(7,"p"),o.EFF(8),o.nI1(9,"currency"),o.k0s(),o.j41(10,"p"),o.EFF(11),o.nI1(12,"number"),o.nI1(13,"currency"),o.k0s(),o.j41(14,"h2"),o.EFF(15),o.nI1(16,"currency"),o.k0s(),o.j41(17,"ion-radio-group",3),o.mxI("ngModelChange",function(s){return o.DH7(a.metodoPago,s)||(a.metodoPago=s),s}),o.j41(18,"ion-list-header")(19,"ion-label"),o.EFF(20,"Selecciona m\xe9todo de pago"),o.k0s()(),o.j41(21,"ion-item")(22,"ion-label"),o.EFF(23,"Efectivo"),o.k0s(),o.nrm(24,"ion-radio",4),o.k0s(),o.j41(25,"ion-item")(26,"ion-label"),o.EFF(27,"Tarjeta"),o.k0s(),o.nrm(28,"ion-radio",5),o.k0s()(),o.j41(29,"ion-button",6),o.bIt("click",function(){return a.confirmarPago()}),o.EFF(30),o.k0s()()),2&e&&(o.Y8G("translucent",!0),o.R7$(8),o.SpI("Total base: ",o.bMT(9,8,a.totalBase),""),o.R7$(3),o.Lme("Ganancia (",o.i5U(12,10,100*a.gananciaPorcentaje,"1.0-0"),"%): ",o.bMT(13,13,a.totalBase*a.gananciaPorcentaje),""),o.R7$(4),o.SpI("Total a pagar: ",o.bMT(16,15,a.totalConGanancia),""),o.R7$(2),o.R50("ngModel",a.metodoPago),o.R7$(12),o.Y8G("disabled",a.procesandoPago),o.R7$(),o.SpI(" ",a.procesandoPago?"Procesando...":"Confirmar Pago","\n"))},dependencies:[p.BC,p.vS,r.Jm,r.W9,r.eU,r.uz,r.he,r.AF,r.KO,r.f0,r.BC,r.ai,r.Je,g.QX,g.oe],encapsulation:2}),l})()}];let y=(()=>{var t;class l{}return(t=l).\u0275fac=function(e){return new(e||t)},t.\u0275mod=o.$C({type:t}),t.\u0275inj=o.G2t({imports:[P.iI.forChild(F),P.iI]}),l})(),b=(()=>{var t;class l{}return(t=l).\u0275fac=function(e){return new(e||t)},t.\u0275mod=o.$C({type:t}),t.\u0275inj=o.G2t({imports:[g.MD,p.YN,r.bv,y]}),l})()}}]);