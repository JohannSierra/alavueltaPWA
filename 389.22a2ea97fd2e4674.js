"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[389],{389:(B,f,l)=>{l.r(f),l.d(f,{EditarPageModule:()=>T});var h=l(2881),m=l(4341),r=l(3092),v=l(5207),g=l(467),u=l(7643),p=l(5312),e=l(1360),E=l(7664),I=l(5032),j=l(5844);const P=["inputImagen"];function b(a,d){1&a&&(e.j41(0,"div",12),e.nrm(1,"ion-spinner",13),e.j41(2,"p"),e.EFF(3,"Cargando producto..."),e.k0s()())}function k(a,d){if(1&a){const o=e.RV6();e.j41(0,"div",33),e.bIt("click",function(){e.eBV(o);const n=e.XpG(2);return e.Njj(n.openImagePreview())}),e.nrm(1,"img",34),e.j41(2,"div",35),e.nrm(3,"ion-icon",36),e.k0s()()}if(2&a){const o=e.XpG(2);e.R7$(),e.Y8G("src",o.imagenPreview,e.B4B)}}function M(a,d){1&a&&(e.j41(0,"div",37),e.nrm(1,"ion-icon",38),e.j41(2,"p"),e.EFF(3,"No hay imagen"),e.k0s()())}function C(a,d){if(1&a){const o=e.RV6();e.j41(0,"ion-button",39),e.bIt("click",function(){e.eBV(o);const n=e.XpG(2);return e.Njj(n.removeImage())}),e.nrm(1,"ion-icon",40),e.EFF(2," Eliminar "),e.k0s()}}function x(a,d){1&a&&e.nrm(0,"ion-spinner",41)}function y(a,d){if(1&a){const o=e.RV6();e.j41(0,"div",14)(1,"div",15),e.DNE(2,k,4,1,"div",16)(3,M,4,0,"div",17),e.j41(4,"div",18)(5,"ion-button",19),e.bIt("click",function(){e.eBV(o);const n=e.XpG();return e.Njj(n.triggerInputImagenClick())}),e.nrm(6,"ion-icon",20),e.EFF(7),e.k0s(),e.DNE(8,C,3,0,"ion-button",21),e.k0s(),e.j41(9,"input",22,0),e.bIt("change",function(n){e.eBV(o);const t=e.XpG();return e.Njj(t.onImageSelected(n))}),e.k0s()(),e.j41(11,"ion-list",23)(12,"ion-item")(13,"ion-label",24),e.EFF(14,"C\xf3digo"),e.k0s(),e.j41(15,"ion-input",25),e.mxI("ngModelChange",function(n){e.eBV(o);const t=e.XpG();return e.DH7(t.producto.codigo,n)||(t.producto.codigo=n),e.Njj(n)}),e.k0s()(),e.j41(16,"ion-item")(17,"ion-label",24),e.EFF(18,"Nombre *"),e.k0s(),e.j41(19,"ion-input",25),e.mxI("ngModelChange",function(n){e.eBV(o);const t=e.XpG();return e.DH7(t.producto.nombre,n)||(t.producto.nombre=n),e.Njj(n)}),e.k0s()(),e.j41(20,"ion-item")(21,"ion-label",24),e.EFF(22,"Precio ($) *"),e.k0s(),e.j41(23,"ion-input",26),e.mxI("ngModelChange",function(n){e.eBV(o);const t=e.XpG();return e.DH7(t.producto.precio,n)||(t.producto.precio=n),e.Njj(n)}),e.k0s()(),e.j41(24,"ion-item")(25,"ion-label",24),e.EFF(26,"Cantidad *"),e.k0s(),e.j41(27,"ion-input",27),e.mxI("ngModelChange",function(n){e.eBV(o);const t=e.XpG();return e.DH7(t.producto.cantidad,n)||(t.producto.cantidad=n),e.Njj(n)}),e.k0s()(),e.j41(28,"ion-item")(29,"ion-label",24),e.EFF(30,"Categor\xeda"),e.k0s(),e.j41(31,"ion-input",28),e.mxI("ngModelChange",function(n){e.eBV(o);const t=e.XpG();return e.DH7(t.producto.categoria,n)||(t.producto.categoria=n),e.Njj(n)}),e.k0s()(),e.j41(32,"ion-item")(33,"ion-label",24),e.EFF(34,"Descripci\xf3n"),e.k0s(),e.j41(35,"ion-textarea",29),e.mxI("ngModelChange",function(n){e.eBV(o);const t=e.XpG();return e.DH7(t.producto.descripcion,n)||(t.producto.descripcion=n),e.Njj(n)}),e.k0s()(),e.j41(36,"ion-item")(37,"ion-label",24),e.EFF(38,"Informaci\xf3n adicional"),e.k0s(),e.j41(39,"ion-textarea",30),e.mxI("ngModelChange",function(n){e.eBV(o);const t=e.XpG();return e.DH7(t.producto.infoExtra,n)||(t.producto.infoExtra=n),e.Njj(n)}),e.k0s()()(),e.j41(40,"ion-button",31),e.bIt("click",function(){e.eBV(o);const n=e.XpG();return e.Njj(n.guardarCambios())}),e.DNE(41,x,1,0,"ion-spinner",32),e.EFF(42),e.k0s()()}if(2&a){const o=e.XpG();e.R7$(2),e.Y8G("ngIf",o.imagenPreview),e.R7$(),e.Y8G("ngIf",!o.imagenPreview),e.R7$(4),e.SpI(" ",o.imagenPreview?"Cambiar imagen":"Agregar imagen"," "),e.R7$(),e.Y8G("ngIf",o.imagenPreview),e.R7$(7),e.R50("ngModel",o.producto.codigo),e.R7$(4),e.R50("ngModel",o.producto.nombre),e.R7$(4),e.R50("ngModel",o.producto.precio),e.R7$(4),e.R50("ngModel",o.producto.cantidad),e.R7$(4),e.R50("ngModel",o.producto.categoria),e.R7$(4),e.R50("ngModel",o.producto.descripcion),e.R7$(4),e.R50("ngModel",o.producto.infoExtra),e.R7$(),e.Y8G("disabled",o.isSaving),e.R7$(),e.Y8G("ngIf",o.isSaving),e.R7$(),e.SpI(" ",o.isSaving?"Guardando...":"Guardar cambios"," ")}}function G(a,d){if(1&a&&e.nrm(0,"img",46),2&a){const o=e.XpG(2);e.Y8G("src",o.imagenPreview,e.B4B)}}function F(a,d){if(1&a){const o=e.RV6();e.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),e.EFF(3,"Vista ampliada"),e.k0s(),e.j41(4,"ion-buttons",5)(5,"ion-button",3),e.bIt("click",function(){e.eBV(o);const n=e.XpG();return e.Njj(n.closeImageModal())}),e.nrm(6,"ion-icon",42),e.k0s()()()(),e.j41(7,"ion-content",43)(8,"div",44),e.DNE(9,G,1,1,"img",45),e.k0s()()}if(2&a){const o=e.XpG();e.R7$(9),e.Y8G("ngIf",o.imagenPreview)}}const R=[{path:"",component:(()=>{var a;class d{constructor(i,n,t,c,s,_){this.route=i,this.navCtrl=n,this.http=t,this.authService=c,this.alertCtrl=s,this.loadingCtrl=_,this.productoId="",this.producto={_id:"",codigo:"",nombre:"",precio:0,cantidad:0,categoria:"",descripcion:"",infoExtra:"",usuario:""},this.showImageModal=!1,this.imagenFile=null,this.imagenPreview=null,this.isLoading=!1,this.isSaving=!1}ngOnInit(){var i=this;return(0,g.A)(function*(){i.productoId=i.route.snapshot.paramMap.get("id")||"",i.productoId&&(yield i.cargarProducto())})()}cargarProducto(){var i=this;return(0,g.A)(function*(){i.isLoading=!0;const n=yield i.loadingCtrl.create({message:"Cargando producto..."});yield n.present();try{const t=yield i.authService.getToken();if(!t)throw new Error("No autenticado");const c=new u.Lr({Authorization:`Bearer ${t}`}),s=yield i.http.get(`${p.c.apiUrl}/api/inventario/${i.productoId}`,{headers:c}).toPromise();if(!s)throw new Error("Producto no encontrado");i.producto=s,i.imagenPreview=s.imagenUrl||null}catch{i.mostrarAlerta("Error","No se pudo cargar el producto"),i.navCtrl.navigateBack("/inventario")}finally{n.dismiss(),i.isLoading=!1}})()}onImageSelected(i){const n=i.target;if(n.files&&n.files[0]){const t=n.files[0];if(t.size>5242880)return void this.mostrarAlerta("Error","La imagen no debe exceder los 5MB");if(!t.type.match(/image\/(jpeg|png|jpg|webp)/))return void this.mostrarAlerta("Error","Formato de imagen no soportado (solo JPEG, PNG, JPG o WEBP)");this.imagenFile=t;const c=new FileReader;c.onload=()=>{this.imagenPreview=c.result},c.readAsDataURL(t)}}removeImage(){this.imagenFile=null,this.imagenPreview=null,this.inputImagen&&(this.inputImagen.nativeElement.value="")}guardarCambios(){var i=this;return(0,g.A)(function*(){if(i.isSaving)return;i.isSaving=!0;const n=yield i.loadingCtrl.create({message:"Guardando cambios..."});yield n.present();try{const c=yield i.authService.getToken();if(!c)throw new Error("No autenticado");const s=new u.Lr({Authorization:`Bearer ${c}`,"Content-Type":"application/json"}),_={codigo:i.producto.codigo,nombre:i.producto.nombre,precio:i.producto.precio,cantidad:i.producto.cantidad,categoria:i.producto.categoria,descripcion:i.producto.descripcion,infoExtra:i.producto.infoExtra};yield i.http.put(`${p.c.apiUrl}/api/inventario/${i.productoId}`,_,{headers:s}).toPromise(),i.imagenFile?yield i.subirImagen():null===i.imagenPreview&&i.producto.imagenUrl&&(yield i.eliminarImagenBackend()),i.mostrarAlerta("\xc9xito","Producto actualizado correctamente"),i.navCtrl.navigateBack("/inventario")}catch(c){var t;let s="Error al guardar los cambios";null!==(t=c.error)&&void 0!==t&&t.mensaje?s=c.error.mensaje:c.message&&(s=c.message),i.mostrarAlerta("Error",s)}finally{n.dismiss(),i.isSaving=!1}})()}subirImagen(){var i=this;return(0,g.A)(function*(){if(!i.imagenFile)return;const n=yield i.authService.getToken();if(!n)return;const t=new FormData;t.append("imagen",i.imagenFile),t.append("codigo",i.producto.codigo),t.append("nombre",i.producto.nombre),t.append("precio",i.producto.precio.toString()),t.append("cantidad",i.producto.cantidad.toString()),t.append("categoria",i.producto.categoria),t.append("descripcion",i.producto.descripcion),t.append("infoExtra",i.producto.infoExtra);const c=new u.Lr({Authorization:`Bearer ${n}`});yield i.http.put(`${p.c.apiUrl}/api/inventario/${i.productoId}`,t,{headers:c}).toPromise()})()}eliminarImagenBackend(){var i=this;return(0,g.A)(function*(){const n=yield i.authService.getToken();if(!n)return;const t=new u.Lr({Authorization:`Bearer ${n}`});yield i.http.delete(`${p.c.apiUrl}/api/inventario/${i.productoId}/imagen`,{headers:t}).toPromise()})()}mostrarConfirmacionSalir(){var i=this;return(0,g.A)(function*(){yield(yield i.alertCtrl.create({header:"\xbfSalir sin guardar?",message:"Tienes cambios sin guardar. \xbfEst\xe1s seguro de que quieres salir?",buttons:[{text:"Cancelar",role:"cancel"},{text:"Salir",handler:()=>{i.navCtrl.navigateBack("/inventario")}}]})).present()})()}mostrarAlerta(i,n){var t=this;return(0,g.A)(function*(){yield(yield t.alertCtrl.create({header:i,message:n,buttons:["OK"]})).present()})()}triggerInputImagenClick(){this.inputImagen&&this.inputImagen.nativeElement&&this.inputImagen.nativeElement.click()}openImagePreview(){this.showImageModal=!0}closeImageModal(){this.showImageModal=!1}}return(a=d).\u0275fac=function(i){return new(i||a)(e.rXU(E.nX),e.rXU(I.q9),e.rXU(u.Qq),e.rXU(j.u),e.rXU(r.hG),e.rXU(r.Xi))},a.\u0275cmp=e.VBU({type:a,selectors:[["app-editar"]],viewQuery:function(i,n){if(1&i&&e.GBs(P,5),2&i){let t;e.mGM(t=e.lsd())&&(n.inputImagen=t.first)}},standalone:!1,decls:15,vars:6,consts:[["inputImagen",""],[3,"translucent"],["slot","start"],[3,"click"],["name","arrow-back","slot","icon-only"],["slot","end"],[3,"click","disabled"],["name","save","slot","icon-only"],[1,"ion-padding",3,"fullscreen"],["class","loading-overlay",4,"ngIf"],["class","form-container",4,"ngIf"],[3,"ionModalDidDismiss","isOpen"],[1,"loading-overlay"],["name","crescent"],[1,"form-container"],[1,"image-section","ion-margin-bottom"],["class","image-container",3,"click",4,"ngIf"],["class","no-image",4,"ngIf"],[1,"image-actions"],["expand","block","fill","outline",3,"click"],["name","camera","slot","start"],["expand","block","fill","outline","color","danger",3,"click",4,"ngIf"],["type","file","accept","image/jpeg, image/png, image/jpg, image/webp",2,"display","none",3,"change"],["lines","full",1,"ion-margin-bottom"],["position","floating"],["type","text","required","",3,"ngModelChange","ngModel"],["type","number","min","0","step","0.01","required","",3,"ngModelChange","ngModel"],["type","number","min","0","required","",3,"ngModelChange","ngModel"],["type","text",3,"ngModelChange","ngModel"],["rows","3","autoGrow","",3,"ngModelChange","ngModel"],["rows","2","autoGrow","",3,"ngModelChange","ngModel"],["expand","block","color","primary",3,"click","disabled"],["name","crescent","slot","start",4,"ngIf"],[1,"image-container",3,"click"],["alt","Imagen del producto",1,"product-image",3,"src"],[1,"image-overlay"],["name","expand",1,"zoom-icon"],[1,"no-image"],["name","image",1,"no-image-icon"],["expand","block","fill","outline","color","danger",3,"click"],["name","trash","slot","start"],["name","crescent","slot","start"],["name","close","slot","icon-only"],[1,"modal-content"],[1,"image-modal-container"],["alt","Imagen ampliada del producto","class","full-size-image",3,"src",4,"ngIf"],["alt","Imagen ampliada del producto",1,"full-size-image",3,"src"]],template:function(i,n){1&i&&(e.j41(0,"ion-header",1)(1,"ion-toolbar")(2,"ion-buttons",2)(3,"ion-button",3),e.bIt("click",function(){return n.mostrarConfirmacionSalir()}),e.nrm(4,"ion-icon",4),e.k0s()(),e.j41(5,"ion-title"),e.EFF(6,"Editar Producto"),e.k0s(),e.j41(7,"ion-buttons",5)(8,"ion-button",6),e.bIt("click",function(){return n.guardarCambios()}),e.nrm(9,"ion-icon",7),e.k0s()()()(),e.j41(10,"ion-content",8),e.DNE(11,b,4,0,"div",9)(12,y,43,14,"div",10),e.j41(13,"ion-modal",11),e.bIt("ionModalDidDismiss",function(){return n.closeImageModal()}),e.DNE(14,F,10,1,"ng-template"),e.k0s()()),2&i&&(e.Y8G("translucent",!0),e.R7$(8),e.Y8G("disabled",n.isSaving),e.R7$(2),e.Y8G("fullscreen",!0),e.R7$(),e.Y8G("ngIf",n.isLoading),e.R7$(),e.Y8G("ngIf",!n.isLoading),e.R7$(),e.Y8G("isOpen",n.showImageModal))},dependencies:[h.bT,m.BC,m.YS,m.vS,r.Jm,r.QW,r.W9,r.eU,r.iq,r.$w,r.uz,r.he,r.nf,r.w2,r.nc,r.BC,r.ai,r.Sb,r.su,r.Gw,r.T6],encapsulation:2}),d})()}];let w=(()=>{var a;class d{}return(a=d).\u0275fac=function(i){return new(i||a)},a.\u0275mod=e.$C({type:a}),a.\u0275inj=e.G2t({imports:[v.iI.forChild(R),v.iI]}),d})(),T=(()=>{var a;class d{}return(a=d).\u0275fac=function(i){return new(i||a)},a.\u0275mod=e.$C({type:a}),a.\u0275inj=e.G2t({imports:[h.MD,m.YN,r.bv,w]}),d})()}}]);