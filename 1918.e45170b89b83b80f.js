"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[1918],{1918:(R,d,s)=>{s.r(d),s.d(d,{HistorialPageModule:()=>E});var c=s(2881),p=s(4341),i=s(3092),g=s(5207),o=s(1360),u=s(7643),m=s(5312);let f=(()=>{var t;class a{constructor(n){this.http=n}getHeaders(){const n=localStorage.getItem("token");return new u.Lr({Authorization:`Bearer ${n}`,"Content-Type":"application/json"})}getHistorialPedidos(){const n=this.getHeaders();return this.http.get(`${m.c.apiUrl}/api/pedidos/historial`,{headers:n})}}return(t=a).\u0275fac=function(n){return new(n||t)(o.KVO(u.Qq))},t.\u0275prov=o.jDH({token:t,factory:t.\u0275fac,providedIn:"root"}),a})();var h=s(5032);function P(t,a){1&t&&(o.j41(0,"div",9),o.nrm(1,"ion-spinner"),o.j41(2,"p"),o.EFF(3,"Cargando historial..."),o.k0s()())}function _(t,a){if(1&t){const e=o.RV6();o.j41(0,"ion-card",10)(1,"ion-card-content")(2,"p"),o.EFF(3),o.k0s(),o.j41(4,"ion-button",11),o.bIt("click",function(){o.eBV(e);const r=o.XpG();return o.Njj(r.cargarHistorial())}),o.EFF(5," Reintentar "),o.k0s()()()}if(2&t){const e=o.XpG();o.R7$(3),o.JRh(e.error)}}function F(t,a){1&t&&(o.j41(0,"div",9),o.nrm(1,"ion-icon",12),o.j41(2,"h3"),o.EFF(3,"No tienes pedidos a\xfan"),o.k0s(),o.j41(4,"p"),o.EFF(5,"Cuando realices tu primer pedido aparecer\xe1 aqu\xed."),o.k0s()())}function v(t,a){if(1&t&&(o.j41(0,"ion-item",21)(1,"div",22),o.EFF(2),o.k0s(),o.j41(3,"ion-label")(4,"h3"),o.EFF(5),o.k0s(),o.j41(6,"p"),o.EFF(7),o.k0s(),o.j41(8,"p",23),o.EFF(9),o.k0s()(),o.j41(10,"ion-note",2),o.EFF(11),o.k0s()()),2&t){const e=a.$implicit,n=o.XpG(3);o.R7$(2),o.SpI(" ",e.cantidad," "),o.R7$(3),o.JRh(e.nombre),o.R7$(2),o.SpI("",n.formatearPrecio(e.precio)," c/u"),o.R7$(2),o.SpI("Vendedor: ",e.vendedor,""),o.R7$(2),o.SpI(" ",n.formatearPrecio(e.precio*e.cantidad)," ")}}function k(t,a){if(1&t&&(o.j41(0,"ion-card",14)(1,"ion-card-header")(2,"ion-card-subtitle")(3,"ion-chip",15)(4,"ion-label"),o.EFF(5),o.nI1(6,"titlecase"),o.k0s()(),o.j41(7,"span",16),o.EFF(8),o.k0s()(),o.j41(9,"ion-card-title"),o.EFF(10),o.k0s()(),o.j41(11,"ion-card-content")(12,"div",17)(13,"h4"),o.EFF(14),o.k0s(),o.DNE(15,v,12,5,"ion-item",18),o.k0s(),o.j41(16,"ion-grid",19)(17,"ion-row")(18,"ion-col",20)(19,"strong"),o.EFF(20,"Subtotal:"),o.k0s(),o.nrm(21,"br"),o.EFF(22),o.k0s(),o.j41(23,"ion-col",20)(24,"strong"),o.EFF(25,"Total final:"),o.k0s(),o.nrm(26,"br"),o.EFF(27),o.k0s()(),o.j41(28,"ion-row")(29,"ion-col",20)(30,"strong"),o.EFF(31,"M\xe9todo de pago:"),o.k0s(),o.nrm(32,"br"),o.EFF(33),o.nI1(34,"titlecase"),o.k0s(),o.j41(35,"ion-col",20)(36,"strong"),o.EFF(37,"Entrega:"),o.k0s(),o.nrm(38,"br"),o.EFF(39),o.k0s()()()()()),2&t){const e=a.$implicit,n=o.XpG(2);o.R7$(3),o.Y8G("color",n.getColorEstado(e.estado)),o.R7$(2),o.JRh(o.bMT(6,10,e.estado)),o.R7$(3),o.JRh(n.formatearFecha(e.fecha)),o.R7$(2),o.SpI(" Pedido #",e._id.slice(-6)," "),o.R7$(4),o.SpI("Productos (",n.getTotalProductos(e)," art\xedculos)"),o.R7$(),o.Y8G("ngForOf",e.productos),o.R7$(7),o.SpI(" ",n.formatearPrecio(e.totalBase)," "),o.R7$(5),o.SpI(" ",n.formatearPrecio(e.totalConComision)," "),o.R7$(6),o.SpI(" ",o.bMT(34,12,e.metodoPago)," "),o.R7$(6),o.SpI(" ",e.direccion," ")}}function H(t,a){if(1&t&&(o.j41(0,"ion-list"),o.DNE(1,k,40,14,"ion-card",13),o.k0s()),2&t){const e=o.XpG();o.R7$(),o.Y8G("ngForOf",e.pedidos)}}const M=[{path:"",component:(()=>{var t;class a{constructor(n,r){this.historialService=n,this.navCtrl=r,this.pedidos=[],this.cargando=!1,this.error=null}ngOnInit(){this.cargarHistorial()}cargarHistorial(){if(this.cargando=!0,this.error=null,!localStorage.getItem("token"))return this.error="No hay sesi\xf3n activa. Por favor, inicia sesi\xf3n.",void(this.cargando=!1);this.historialService.getHistorialPedidos().subscribe({next:r=>{this.pedidos=r,this.cargando=!1}})}refrescar(n){this.cargarHistorial(),n&&n.target.complete()}getTotalProductos(n){return n.productos.reduce((r,l)=>r+l.cantidad,0)}formatearFecha(n){return new Date(n).toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}formatearPrecio(n){return new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN"}).format(n)}getColorEstado(n){switch(n){case"pendiente":return"warning";case"confirmado":return"primary";case"entregado":return"success";case"cancelado":return"danger";default:return"medium"}}volver(){this.navCtrl.navigateBack("/hub")}}return(t=a).\u0275fac=function(n){return new(n||t)(o.rXU(f),o.rXU(h.q9))},t.\u0275cmp=o.VBU({type:t,selectors:[["app-historial"]],standalone:!1,decls:17,vars:4,consts:[["slot","start"],["expand","block","color","medium","slot","start",3,"click"],["slot","end"],[3,"click"],["name","refresh"],["slot","fixed",3,"ionRefresh"],["class","ion-text-center ion-padding",4,"ngIf"],["color","danger",4,"ngIf"],[4,"ngIf"],[1,"ion-text-center","ion-padding"],["color","danger"],["expand","block","fill","clear",3,"click"],["name","receipt-outline","size","large","color","medium"],["class","pedido-card",4,"ngFor","ngForOf"],[1,"pedido-card"],[3,"color"],[1,"fecha"],[1,"productos-section"],["lines","none",4,"ngFor","ngForOf"],[1,"detalles-grid"],["size","6"],["lines","none"],["slot","start",1,"cantidad-badge"],[1,"vendedor"]],template:function(n,r){1&n&&(o.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0)(3,"ion-button",1),o.bIt("click",function(){return r.volver()}),o.EFF(4," Atr\xe1s "),o.k0s()(),o.j41(5,"ion-title"),o.EFF(6,"Historial de Pedidos"),o.k0s(),o.j41(7,"ion-buttons",2)(8,"ion-button",3),o.bIt("click",function(){return r.refrescar()}),o.nrm(9,"ion-icon",4),o.k0s()()()(),o.j41(10,"ion-content")(11,"ion-refresher",5),o.bIt("ionRefresh",function(b){return r.refrescar(b)}),o.nrm(12,"ion-refresher-content"),o.k0s(),o.DNE(13,P,4,0,"div",6)(14,_,6,1,"ion-card",7)(15,F,6,0,"div",6)(16,H,2,1,"ion-list",8),o.k0s()),2&n&&(o.R7$(13),o.Y8G("ngIf",r.cargando),o.R7$(),o.Y8G("ngIf",r.error&&!r.cargando),o.R7$(),o.Y8G("ngIf",!r.cargando&&!r.error&&0===r.pedidos.length),o.R7$(),o.Y8G("ngIf",!r.cargando&&!r.error&&r.pedidos.length>0))},dependencies:[c.Sq,c.bT,i.Jm,i.QW,i.b_,i.I9,i.ME,i.HW,i.tN,i.ZB,i.hU,i.W9,i.lO,i.eU,i.iq,i.uz,i.he,i.nf,i.JI,i.To,i.Ki,i.ln,i.w2,i.BC,i.ai,c.PV],styles:[".pedido-card[_ngcontent-%COMP%]{margin:8px}.pedido-card[_ngcontent-%COMP%]   ion-card-subtitle[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.pedido-card[_ngcontent-%COMP%]   ion-card-subtitle[_ngcontent-%COMP%]   .fecha[_ngcontent-%COMP%]{color:var(--ion-color-medium);font-size:.8em}.productos-section[_ngcontent-%COMP%]{margin-bottom:16px}.productos-section[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 8px;color:var(--ion-color-primary);font-size:.9em;font-weight:600}.productos-section[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{--padding-start: 0;--inner-padding-end: 0}.productos-section[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   .cantidad-badge[_ngcontent-%COMP%]{background:var(--ion-color-primary);color:#fff;border-radius:50%;width:24px;height:24px;display:flex;align-items:center;justify-content:center;font-size:.8em;font-weight:700;margin-right:12px}.productos-section[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   .vendedor[_ngcontent-%COMP%]{font-size:.8em;color:var(--ion-color-medium)}.detalles-grid[_ngcontent-%COMP%]{margin-top:16px;padding-top:16px;border-top:1px solid var(--ion-color-light)}.detalles-grid[_ngcontent-%COMP%]   ion-col[_ngcontent-%COMP%]{font-size:.9em}.detalles-grid[_ngcontent-%COMP%]   ion-col[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:var(--ion-color-dark)}"]}),a})()}];let C=(()=>{var t;class a{}return(t=a).\u0275fac=function(n){return new(n||t)},t.\u0275mod=o.$C({type:t}),t.\u0275inj=o.G2t({imports:[g.iI.forChild(M),g.iI]}),a})(),E=(()=>{var t;class a{}return(t=a).\u0275fac=function(n){return new(n||t)},t.\u0275mod=o.$C({type:t}),t.\u0275inj=o.G2t({imports:[c.MD,p.YN,i.bv,C]}),a})()}}]);