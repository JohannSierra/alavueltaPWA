"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[1918],{1918:(R,d,s)=>{s.r(d),s.d(d,{HistorialPageModule:()=>C});var c=s(2881),p=s(4341),r=s(3092),g=s(5207),o=s(1360),u=s(7643),f=s(5312);let m=(()=>{var e;class a{constructor(t){this.http=t}getHeaders(){const t=localStorage.getItem("token");return new u.Lr({Authorization:`Bearer ${t}`,"Content-Type":"application/json"})}getHistorialPedidos(){const t=this.getHeaders();return this.http.get(`${f.c.apiUrl}/api/pedidos/historial`,{headers:t})}}return(e=a).\u0275fac=function(t){return new(t||e)(o.KVO(u.Qq))},e.\u0275prov=o.jDH({token:e,factory:e.\u0275fac,providedIn:"root"}),a})();var h=s(5032);function P(e,a){1&e&&(o.j41(0,"div",9),o.nrm(1,"ion-spinner"),o.j41(2,"p"),o.EFF(3,"Cargando historial..."),o.k0s()())}function _(e,a){if(1&e){const n=o.RV6();o.j41(0,"ion-card",10)(1,"ion-card-content")(2,"p"),o.EFF(3),o.k0s(),o.j41(4,"ion-button",11),o.bIt("click",function(){o.eBV(n);const i=o.XpG();return o.Njj(i.cargarHistorial())}),o.EFF(5," Reintentar "),o.k0s()()()}if(2&e){const n=o.XpG();o.R7$(3),o.JRh(n.error)}}function F(e,a){1&e&&(o.j41(0,"div",9),o.nrm(1,"ion-icon",12),o.j41(2,"h3"),o.EFF(3,"No tienes pedidos a\xfan"),o.k0s(),o.j41(4,"p"),o.EFF(5,"Cuando realices tu primer pedido aparecer\xe1 aqu\xed."),o.k0s()())}function v(e,a){if(1&e&&(o.j41(0,"ion-item",21)(1,"div",22),o.EFF(2),o.k0s(),o.j41(3,"ion-label")(4,"h3"),o.EFF(5),o.k0s(),o.j41(6,"p"),o.EFF(7),o.k0s(),o.j41(8,"p",23),o.EFF(9),o.k0s()(),o.j41(10,"ion-note",2),o.EFF(11),o.k0s()()),2&e){const n=a.$implicit,t=o.XpG(3);o.R7$(2),o.SpI(" ",n.cantidad," "),o.R7$(3),o.JRh(n.nombre),o.R7$(2),o.SpI("",t.formatearPrecio(n.precio)," c/u"),o.R7$(2),o.SpI("Vendedor: ",n.vendedor,""),o.R7$(2),o.SpI(" ",t.formatearPrecio(n.precio*n.cantidad)," ")}}function k(e,a){if(1&e&&(o.j41(0,"ion-card",14)(1,"ion-card-header")(2,"ion-card-subtitle")(3,"ion-chip",15)(4,"ion-label"),o.EFF(5),o.nI1(6,"titlecase"),o.k0s()(),o.j41(7,"span",16),o.EFF(8),o.k0s()(),o.j41(9,"ion-card-title"),o.EFF(10),o.k0s()(),o.j41(11,"ion-card-content")(12,"div",17)(13,"h4"),o.EFF(14),o.k0s(),o.DNE(15,v,12,5,"ion-item",18),o.k0s(),o.j41(16,"ion-grid",19)(17,"ion-row")(18,"ion-col",20)(19,"strong"),o.EFF(20,"Subtotal:"),o.k0s(),o.nrm(21,"br"),o.EFF(22),o.k0s(),o.j41(23,"ion-col",20)(24,"strong"),o.EFF(25,"Total final:"),o.k0s(),o.nrm(26,"br"),o.EFF(27),o.k0s()(),o.j41(28,"ion-row")(29,"ion-col",20)(30,"strong"),o.EFF(31,"M\xe9todo de pago:"),o.k0s(),o.nrm(32,"br"),o.EFF(33),o.nI1(34,"titlecase"),o.k0s(),o.j41(35,"ion-col",20)(36,"strong"),o.EFF(37,"Entrega:"),o.k0s(),o.nrm(38,"br"),o.EFF(39),o.k0s()()()()()),2&e){const n=a.$implicit,t=o.XpG(2);o.R7$(3),o.Y8G("color",t.getColorEstado(n.estado)),o.R7$(2),o.JRh(o.bMT(6,10,n.estado)),o.R7$(3),o.JRh(t.formatearFecha(n.fecha)),o.R7$(2),o.SpI(" Pedido #",n._id.slice(-6)," "),o.R7$(4),o.SpI("Productos (",t.getTotalProductos(n)," art\xedculos)"),o.R7$(),o.Y8G("ngForOf",n.productos),o.R7$(7),o.SpI(" ",t.formatearPrecio(n.totalBase)," "),o.R7$(5),o.SpI(" ",t.formatearPrecio(n.totalConComision)," "),o.R7$(6),o.SpI(" ",o.bMT(34,12,n.metodoPago)," "),o.R7$(6),o.SpI(" ",n.direccion," ")}}function H(e,a){if(1&e&&(o.j41(0,"ion-list"),o.DNE(1,k,40,14,"ion-card",13),o.k0s()),2&e){const n=o.XpG();o.R7$(),o.Y8G("ngForOf",n.pedidos)}}const M=[{path:"",component:(()=>{var e;class a{constructor(t,i){this.historialService=t,this.navCtrl=i,this.pedidos=[],this.cargando=!1,this.error=null}ngOnInit(){this.cargarHistorial()}cargarHistorial(){if(this.cargando=!0,this.error=null,!localStorage.getItem("token"))return this.error="No hay sesi\xf3n activa. Por favor, inicia sesi\xf3n.",void(this.cargando=!1);console.log("Obteniendo historial de pedidos..."),this.historialService.getHistorialPedidos().subscribe({next:i=>{console.log("Historial recibido:",i),this.pedidos=i,this.cargando=!1,0===i.length&&console.log("No se encontraron pedidos para este usuario")},error:i=>{console.error("Error completo:",i),this.error=401===i.status?"Sesi\xf3n expirada. Por favor, inicia sesi\xf3n nuevamente.":403===i.status?"No tienes permisos para ver este historial.":0===i.status?"No se puede conectar al servidor. Verifica tu conexi\xf3n.":"No se pudo cargar el historial de pedidos.",this.cargando=!1}})}refrescar(t){this.cargarHistorial(),t&&t.target.complete()}getTotalProductos(t){return t.productos.reduce((i,l)=>i+l.cantidad,0)}formatearFecha(t){return new Date(t).toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})}formatearPrecio(t){return new Intl.NumberFormat("es-MX",{style:"currency",currency:"MXN"}).format(t)}getColorEstado(t){switch(t){case"pendiente":return"warning";case"confirmado":return"primary";case"entregado":return"success";case"cancelado":return"danger";default:return"medium"}}volver(){this.navCtrl.navigateBack("/hub")}}return(e=a).\u0275fac=function(t){return new(t||e)(o.rXU(m),o.rXU(h.q9))},e.\u0275cmp=o.VBU({type:e,selectors:[["app-historial"]],standalone:!1,decls:17,vars:4,consts:[["slot","start"],["expand","block","color","medium","slot","start",3,"click"],["slot","end"],[3,"click"],["name","refresh"],["slot","fixed",3,"ionRefresh"],["class","ion-text-center ion-padding",4,"ngIf"],["color","danger",4,"ngIf"],[4,"ngIf"],[1,"ion-text-center","ion-padding"],["color","danger"],["expand","block","fill","clear",3,"click"],["name","receipt-outline","size","large","color","medium"],["class","pedido-card",4,"ngFor","ngForOf"],[1,"pedido-card"],[3,"color"],[1,"fecha"],[1,"productos-section"],["lines","none",4,"ngFor","ngForOf"],[1,"detalles-grid"],["size","6"],["lines","none"],["slot","start",1,"cantidad-badge"],[1,"vendedor"]],template:function(t,i){1&t&&(o.j41(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0)(3,"ion-button",1),o.bIt("click",function(){return i.volver()}),o.EFF(4," Atr\xe1s "),o.k0s()(),o.j41(5,"ion-title"),o.EFF(6,"Historial de Pedidos"),o.k0s(),o.j41(7,"ion-buttons",2)(8,"ion-button",3),o.bIt("click",function(){return i.refrescar()}),o.nrm(9,"ion-icon",4),o.k0s()()()(),o.j41(10,"ion-content")(11,"ion-refresher",5),o.bIt("ionRefresh",function(E){return i.refrescar(E)}),o.nrm(12,"ion-refresher-content"),o.k0s(),o.DNE(13,P,4,0,"div",6)(14,_,6,1,"ion-card",7)(15,F,6,0,"div",6)(16,H,2,1,"ion-list",8),o.k0s()),2&t&&(o.R7$(13),o.Y8G("ngIf",i.cargando),o.R7$(),o.Y8G("ngIf",i.error&&!i.cargando),o.R7$(),o.Y8G("ngIf",!i.cargando&&!i.error&&0===i.pedidos.length),o.R7$(),o.Y8G("ngIf",!i.cargando&&!i.error&&i.pedidos.length>0))},dependencies:[c.Sq,c.bT,r.Jm,r.QW,r.b_,r.I9,r.ME,r.HW,r.tN,r.ZB,r.hU,r.W9,r.lO,r.eU,r.iq,r.uz,r.he,r.nf,r.JI,r.To,r.Ki,r.ln,r.w2,r.BC,r.ai,c.PV],styles:[".pedido-card[_ngcontent-%COMP%]{margin:8px}.pedido-card[_ngcontent-%COMP%]   ion-card-subtitle[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.pedido-card[_ngcontent-%COMP%]   ion-card-subtitle[_ngcontent-%COMP%]   .fecha[_ngcontent-%COMP%]{color:var(--ion-color-medium);font-size:.8em}.productos-section[_ngcontent-%COMP%]{margin-bottom:16px}.productos-section[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 8px;color:var(--ion-color-primary);font-size:.9em;font-weight:600}.productos-section[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{--padding-start: 0;--inner-padding-end: 0}.productos-section[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   .cantidad-badge[_ngcontent-%COMP%]{background:var(--ion-color-primary);color:#fff;border-radius:50%;width:24px;height:24px;display:flex;align-items:center;justify-content:center;font-size:.8em;font-weight:700;margin-right:12px}.productos-section[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]   .vendedor[_ngcontent-%COMP%]{font-size:.8em;color:var(--ion-color-medium)}.detalles-grid[_ngcontent-%COMP%]{margin-top:16px;padding-top:16px;border-top:1px solid var(--ion-color-light)}.detalles-grid[_ngcontent-%COMP%]   ion-col[_ngcontent-%COMP%]{font-size:.9em}.detalles-grid[_ngcontent-%COMP%]   ion-col[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{color:var(--ion-color-dark)}"]}),a})()}];let b=(()=>{var e;class a{}return(e=a).\u0275fac=function(t){return new(t||e)},e.\u0275mod=o.$C({type:e}),e.\u0275inj=o.G2t({imports:[g.iI.forChild(M),g.iI]}),a})(),C=(()=>{var e;class a{}return(e=a).\u0275fac=function(t){return new(t||e)},e.\u0275mod=o.$C({type:e}),e.\u0275inj=o.G2t({imports:[c.MD,p.YN,r.bv,b]}),a})()}}]);