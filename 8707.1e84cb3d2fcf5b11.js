"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[8707],{8707:(w,h,s)=>{s.r(h),s.d(h,{CarritoPageModule:()=>T});var u=s(2881),b=s(4341),c=s(3092),_=s(5207),l=s(467),g=s(7643),C=s(5312),m=s(9579),t=s(1360),P=s(5032),v=s(8198);function M(r,d){if(1&r){const i=t.RV6();t.j41(0,"ion-card",21)(1,"ion-card-content",22)(2,"div",23)(3,"div",24)(4,"h3",25),t.EFF(5),t.k0s(),t.j41(6,"ion-button",26),t.bIt("click",function(){const n=t.eBV(i).index,o=t.XpG(2);return t.Njj(o.eliminarProducto(n))}),t.nrm(7,"ion-icon",27),t.k0s()(),t.j41(8,"div",28)(9,"div",29),t.nrm(10,"ion-icon",30),t.j41(11,"span",31),t.EFF(12),t.k0s()(),t.j41(13,"div",29),t.nrm(14,"ion-icon",32),t.j41(15,"span",31),t.EFF(16),t.nI1(17,"number"),t.k0s()(),t.j41(18,"div",29),t.nrm(19,"ion-icon",33),t.j41(20,"span",31),t.EFF(21),t.k0s()()()(),t.j41(22,"div",34)(23,"div",35)(24,"span",36),t.EFF(25,"Cantidad"),t.k0s(),t.j41(26,"span",37),t.EFF(27),t.nI1(28,"number"),t.k0s()(),t.j41(29,"div",38)(30,"ion-button",39),t.bIt("click",function(){const n=t.eBV(i).index,o=t.XpG(2);return t.Njj(o.disminuirCantidad(n))}),t.nrm(31,"ion-icon",40),t.k0s(),t.j41(32,"ion-input",41),t.bIt("ionChange",function(n){const o=t.eBV(i).index,a=t.XpG(2);return t.Njj(a.cambiarCantidad(o,a.parseNumber(n.detail.value)))}),t.k0s(),t.j41(33,"ion-button",39),t.bIt("click",function(){const n=t.eBV(i).index,o=t.XpG(2);return t.Njj(o.aumentarCantidad(n))}),t.nrm(34,"ion-icon",42),t.k0s()()()()()}if(2&r){const i=d.$implicit;t.R7$(5),t.JRh(i.nombre),t.R7$(7),t.JRh(i.vendedor),t.R7$(4),t.SpI("$",t.i5U(17,9,i.precio,"1.2-2")," c/u"),t.R7$(5),t.SpI("Disponible: ",i.disponible,""),t.R7$(6),t.SpI("$",t.i5U(28,12,i.precio*i.cantidad,"1.2-2"),""),t.R7$(3),t.Y8G("disabled",i.cantidad<=1),t.R7$(2),t.Y8G("value",i.cantidad)("max",i.disponible),t.R7$(),t.Y8G("disabled",i.cantidad>=i.disponible)}}function y(r,d){if(1&r&&(t.j41(0,"section",12)(1,"div",13),t.DNE(2,M,35,15,"ion-card",14),t.k0s(),t.j41(3,"ion-card",15)(4,"ion-card-header",16)(5,"ion-card-title"),t.EFF(6,"Resumen del Pedido"),t.k0s()(),t.j41(7,"ion-card-content",17)(8,"div",18)(9,"span"),t.EFF(10),t.k0s(),t.j41(11,"span"),t.EFF(12),t.nI1(13,"number"),t.k0s()(),t.j41(14,"div",19)(15,"strong"),t.EFF(16,"Total"),t.k0s(),t.j41(17,"strong",20),t.EFF(18),t.nI1(19,"number"),t.k0s()()()()()),2&r){const i=t.XpG();t.R7$(2),t.Y8G("ngForOf",i.productos),t.R7$(8),t.SpI("Subtotal (",i.getTotalProductos()," productos)"),t.R7$(2),t.SpI("$",t.i5U(13,4,i.total,"1.2-2"),""),t.R7$(6),t.SpI("$",t.i5U(19,7,i.total,"1.2-2"),"")}}function k(r,d){if(1&r){const i=t.RV6();t.j41(0,"section",43)(1,"div",44),t.nrm(2,"ion-icon",45),t.j41(3,"h3",46),t.EFF(4,"Tu carrito est\xe1 vac\xedo"),t.k0s(),t.j41(5,"p",47),t.EFF(6,"Agrega algunos productos para continuar"),t.k0s(),t.j41(7,"ion-button",48),t.bIt("click",function(){t.eBV(i);const n=t.XpG();return t.Njj(n.volver())}),t.nrm(8,"ion-icon",49),t.EFF(9," Explorar Productos "),t.k0s()()()}}function O(r,d){if(1&r){const i=t.RV6();t.j41(0,"div",50)(1,"div",51)(2,"div",52)(3,"span",53),t.EFF(4,"Total:"),t.k0s(),t.j41(5,"span",54),t.EFF(6),t.nI1(7,"number"),t.k0s()(),t.j41(8,"ion-button",55),t.bIt("click",function(){t.eBV(i);const n=t.XpG();return t.Njj(n.checkout())}),t.nrm(9,"ion-icon",56),t.EFF(10," Comprar "),t.k0s()()()}if(2&r){const i=t.XpG();t.R7$(6),t.SpI("$",t.i5U(7,1,i.total,"1.2-2"),"")}}const j=[{path:"",component:(()=>{var r;class d{constructor(e,n,o,a){this.http=e,this.toastCtrl=n,this.navCtrl=o,this.pedirService=a,this.productos=[],this.total=0,this.apiUrl=C.c.apiUrl}ngOnInit(){this.cargarCarrito()}cargarCarrito(){var e=this;return(0,l.A)(function*(){try{const n=(0,m.getAuth)().currentUser;if(!n)return;const o=yield n.getIdToken(),a=new g.Lr({Authorization:`Bearer ${o}`}),p=yield e.http.get(`${e.apiUrl}/api/carrito`,{headers:a}).toPromise();e.productos=p.productos||[],e.calcularTotal()}catch{e.showToast("No se pudo cargar el carrito")}})()}calcularTotal(){this.total=this.productos.reduce((e,n)=>e+n.precio*n.cantidad,0)}cambiarCantidad(e,n){const o=parseInt(n,10),a=this.productos[e];isNaN(o)||o<=0||(o>a.disponible?(this.showToast(`Solo hay ${a.disponible} unidades disponibles`),this.productos[e].cantidad=a.disponible):this.productos[e].cantidad=o,this.calcularTotal())}parseNumber(e){return parseInt(e||"0",10)}aumentarCantidad(e){var n=this;return(0,l.A)(function*(){const o=n.productos[e];o.cantidad<o.disponible?yield n.actualizarCantidad(o.codigo,o.cantidad+1):n.showToast("No hay m\xe1s stock disponible")})()}disminuirCantidad(e){var n=this;return(0,l.A)(function*(){const o=n.productos[e];o.cantidad>1?yield n.actualizarCantidad(o.codigo,o.cantidad-1):yield n.eliminarProducto(e)})()}actualizarCantidad(e,n){var o=this;return(0,l.A)(function*(){try{const a=(0,m.getAuth)().currentUser;if(!a)return;const p=yield a.getIdToken(),f=new g.Lr({Authorization:`Bearer ${p}`});yield o.http.put(`${o.apiUrl}/api/carrito`,{productoId:e,cantidad:n},{headers:f}).toPromise();const x=o.productos.findIndex(I=>I.codigo===e);x>=0&&(o.productos[x].cantidad=n,o.calcularTotal())}catch{o.showToast("No se pudo actualizar la cantidad")}})()}eliminarProducto(e){var n=this;return(0,l.A)(function*(){try{const o=(0,m.getAuth)().currentUser;if(!o)return;const a=yield o.getIdToken(),p=new g.Lr({Authorization:`Bearer ${a}`}),f=n.productos[e];yield n.http.delete(`${n.apiUrl}/api/carrito/${f.codigo}`,{headers:p}).toPromise(),n.productos.splice(e,1),n.calcularTotal(),n.showToast("Producto eliminado del carrito")}catch{n.showToast("No se pudo eliminar el producto")}})()}checkout(){if(0===this.productos.length)return void this.showToast("Tu carrito est\xe1 vac\xedo");const e=this.productos.map(o=>({codigo:o.codigo,nombre:o.nombre,precio:o.precio,cantidad:o.cantidad,vendedor:o.vendedor,disponible:o.disponible,categoria:o.categoria}));this.pedirService.setProductos(e),0!==this.pedirService.getProductos().length?this.navCtrl.navigateForward("/pago"):this.showToast("Error al preparar el pedido. Intenta de nuevo.")}showToast(e){var n=this;return(0,l.A)(function*(){(yield n.toastCtrl.create({message:e,duration:2e3,position:"bottom"})).present()})()}volver(){this.navCtrl.navigateRoot("/hub")}getTotalProductos(){return this.productos.reduce((e,n)=>e+n.cantidad,0)}}return(r=d).\u0275fac=function(e){return new(e||r)(t.rXU(g.Qq),t.rXU(c.K_),t.rXU(P.q9),t.rXU(v.O))},r.\u0275cmp=t.VBU({type:r,selectors:[["app-carrito"]],standalone:!1,decls:16,vars:5,consts:[["carritoVacio",""],[1,"carrito-header",3,"translucent"],["slot","start"],["fill","clear",1,"back-button",3,"click"],[1,"page-title"],["slot","end"],["fill","clear",1,"refresh-button",3,"click"],["slot","icon-only","name","refresh-outline"],[1,"carrito-content",3,"fullscreen"],[1,"content-wrapper"],["class","carrito-section",4,"ngIf","ngIfElse"],["class","checkout-footer-internal",4,"ngIf"],[1,"carrito-section"],[1,"productos-list"],["class","producto-card",4,"ngFor","ngForOf"],[1,"resumen-card"],[1,"resumen-header"],[1,"resumen-content"],[1,"resumen-item"],[1,"resumen-item","total"],[1,"total-price"],[1,"producto-card"],[1,"card-content"],[1,"producto-info"],[1,"producto-header"],[1,"producto-nombre"],["fill","clear","color","danger",1,"delete-button",3,"click"],["slot","icon-only","name","trash-outline"],[1,"producto-details"],[1,"detail-item"],["name","storefront-outline",1,"detail-icon"],[1,"detail-text"],["name","pricetag-outline",1,"detail-icon"],["name","cube-outline",1,"detail-icon"],[1,"cantidad-controls"],[1,"cantidad-header"],[1,"cantidad-label"],[1,"subtotal"],[1,"cantidad-buttons"],["fill","clear","color","medium",1,"cantidad-btn",3,"click","disabled"],["slot","icon-only","name","remove-circle-outline"],["type","number","min","1","inputmode","numeric",1,"cantidad-input",3,"ionChange","value","max"],["slot","icon-only","name","add-circle-outline"],[1,"empty-section"],[1,"empty-state"],["name","cart-outline",1,"empty-icon"],[1,"empty-title"],[1,"empty-message"],["expand","block","color","primary",1,"empty-button",3,"click"],["slot","start","name","storefront-outline"],[1,"checkout-footer-internal"],[1,"footer-content"],[1,"footer-total"],[1,"total-label"],[1,"total-amount"],["expand","block","color","success",1,"checkout-button",3,"click"],["slot","start","name","card-outline"]],template:function(e,n){if(1&e){const o=t.RV6();t.j41(0,"ion-header",1)(1,"ion-toolbar")(2,"ion-buttons",2)(3,"ion-button",3),t.bIt("click",function(){return t.eBV(o),t.Njj(n.volver())}),t.EFF(4," Atras "),t.k0s()(),t.j41(5,"ion-title",4),t.EFF(6,"Mi Carrito"),t.k0s(),t.j41(7,"ion-buttons",5)(8,"ion-button",6),t.bIt("click",function(){return t.eBV(o),t.Njj(n.cargarCarrito())}),t.nrm(9,"ion-icon",7),t.k0s()()()(),t.j41(10,"ion-content",8)(11,"div",9),t.DNE(12,y,20,10,"section",10)(13,k,10,0,"ng-template",null,0,t.C5r),t.k0s(),t.DNE(15,O,11,4,"div",11),t.k0s()}if(2&e){const o=t.sdS(14);t.Y8G("translucent",!0),t.R7$(10),t.Y8G("fullscreen",!0),t.R7$(2),t.Y8G("ngIf",n.productos.length>0)("ngIfElse",o),t.R7$(3),t.Y8G("ngIf",n.productos.length>0)}},dependencies:[u.Sq,u.bT,c.Jm,c.QW,c.b_,c.I9,c.ME,c.tN,c.W9,c.eU,c.iq,c.$w,c.BC,c.ai,c.su,u.QX],styles:['@charset "UTF-8";.carrito-header[_ngcontent-%COMP%]   .page-title[_ngcontent-%COMP%]{font-weight:600;font-size:1.1rem}.carrito-content[_ngcontent-%COMP%]{--padding-bottom: 120px}.content-wrapper[_ngcontent-%COMP%]{padding-bottom:100px}.carrito-section[_ngcontent-%COMP%]{padding:16px}.productos-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px;margin-bottom:20px}.producto-card[_ngcontent-%COMP%]{margin:0;border-radius:16px;box-shadow:0 2px 12px #00000014}.card-content[_ngcontent-%COMP%]{padding:16px}.producto-info[_ngcontent-%COMP%]{margin-bottom:16px}.producto-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:12px}.producto-nombre[_ngcontent-%COMP%]{margin:0 12px 0 0;font-size:1.1rem;font-weight:600;color:#2c3e50;line-height:1.3;flex:1}.delete-button[_ngcontent-%COMP%]{--padding-start: 8px;--padding-end: 8px;margin:-8px -8px 0 0}.producto-details[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px}.detail-item[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.detail-icon[_ngcontent-%COMP%]{font-size:16px;color:var(--ion-color-medium)}.detail-text[_ngcontent-%COMP%]{font-size:.9rem;color:#666}.cantidad-controls[_ngcontent-%COMP%]{border-top:1px solid #f0f0f0;padding-top:16px}.cantidad-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}.cantidad-label[_ngcontent-%COMP%]{font-size:.9rem;color:#666;font-weight:500}.subtotal[_ngcontent-%COMP%]{font-size:1rem;font-weight:600;color:var(--ion-color-success)}.cantidad-buttons[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:8px}.cantidad-btn[_ngcontent-%COMP%]{--padding-start: 4px;--padding-end: 4px;margin:0}.cantidad-input[_ngcontent-%COMP%]{--padding-start: 8px;--padding-end: 8px;width:70px;text-align:center;font-weight:600;border:2px solid #e0e0e0;border-radius:8px}.resumen-card[_ngcontent-%COMP%]{margin:0;border-radius:16px;box-shadow:0 2px 12px #00000014}.resumen-header[_ngcontent-%COMP%]{padding-bottom:8px}.resumen-content[_ngcontent-%COMP%]{padding-top:0}.resumen-item[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:8px 0;border-bottom:1px solid #f0f0f0}.resumen-item[_ngcontent-%COMP%]:last-child{border-bottom:none}.resumen-item.total[_ngcontent-%COMP%]{padding-top:12px;border-top:2px solid #e0e0e0;margin-top:8px}.total-price[_ngcontent-%COMP%]{font-size:1.3rem;color:var(--ion-color-success)}.empty-section[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;min-height:60vh;padding:40px 20px}.empty-state[_ngcontent-%COMP%]{text-align:center;max-width:300px}.empty-icon[_ngcontent-%COMP%]{font-size:80px;color:var(--ion-color-medium);margin-bottom:20px;opacity:.7}.empty-title[_ngcontent-%COMP%]{font-size:1.4rem;font-weight:600;color:#2c3e50;margin-bottom:8px}.empty-message[_ngcontent-%COMP%]{color:#666;margin-bottom:24px;line-height:1.5}.empty-button[_ngcontent-%COMP%]{--border-radius: 12px}.checkout-footer-internal[_ngcontent-%COMP%]{position:fixed;bottom:0;left:0;right:0;padding:16px;border-top:1px solid #e0e0e0;box-shadow:0 -2px 10px #0000001a;z-index:1000;background:#fff}.footer-content[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;max-width:600px;margin:0 auto;gap:16px}.footer-total[_ngcontent-%COMP%]{display:flex;flex-direction:column;flex:1}.total-label[_ngcontent-%COMP%]{font-size:.9rem;color:#666;margin-bottom:2px}.total-amount[_ngcontent-%COMP%]{font-size:1.4rem;font-weight:700;color:var(--ion-color-success)}.checkout-button[_ngcontent-%COMP%]{--border-radius: 12px;margin:0;height:48px;font-weight:600;min-width:140px}@media (max-width: 380px){.carrito-section[_ngcontent-%COMP%]{padding:12px}.producto-nombre[_ngcontent-%COMP%]{font-size:1rem}.checkout-footer-internal[_ngcontent-%COMP%]{padding:12px}.footer-content[_ngcontent-%COMP%]{flex-direction:column;gap:12px}.footer-total[_ngcontent-%COMP%]{align-items:center}.checkout-button[_ngcontent-%COMP%]{width:100%;min-width:auto}}@media (min-width: 768px){.content-wrapper[_ngcontent-%COMP%]{max-width:600px;margin:0 auto}.producto-card[_ngcontent-%COMP%]   .card-content[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center}.producto-info[_ngcontent-%COMP%]{flex:1;margin-bottom:0;margin-right:20px}.cantidad-controls[_ngcontent-%COMP%]{border-top:none;border-left:1px solid #f0f0f0;padding-top:0;padding-left:20px;min-width:180px}.footer-content[_ngcontent-%COMP%]{max-width:600px}}']}),d})()}];let F=(()=>{var r;class d{}return(r=d).\u0275fac=function(e){return new(e||r)},r.\u0275mod=t.$C({type:r}),r.\u0275inj=t.G2t({imports:[_.iI.forChild(j),_.iI]}),d})(),T=(()=>{var r;class d{}return(r=d).\u0275fac=function(e){return new(e||r)},r.\u0275mod=t.$C({type:r}),r.\u0275inj=t.G2t({imports:[u.MD,b.YN,c.bv,F]}),d})()}}]);