"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5848],{5848:(x,m,c)=>{c.r(m),c.d(m,{ProductoPageModule:()=>I});var h=c(2881),f=c(4341),s=c(3092),v=c(5207),u=c(467),p=c(7643),g=c(5312),o=c(1360),P=c(7664),F=c(4796),k=c(5032);function b(e,l){if(1&e&&(o.j41(0,"p")(1,"strong"),o.EFF(2,"Informaci\xf3n extra:"),o.k0s(),o.EFF(3),o.k0s()),2&e){const n=o.XpG(2);o.R7$(3),o.SpI(" ",n.producto.infoExtra,"")}}function E(e,l){if(1&e){const n=o.RV6();o.qex(0),o.j41(1,"div",5),o.nrm(2,"img",6),o.k0s(),o.j41(3,"ion-card")(4,"ion-card-header")(5,"ion-card-title"),o.EFF(6),o.k0s(),o.j41(7,"ion-card-subtitle"),o.EFF(8),o.k0s()(),o.j41(9,"ion-card-content")(10,"p")(11,"strong"),o.EFF(12,"Vendedor:"),o.k0s(),o.EFF(13),o.k0s(),o.j41(14,"p")(15,"strong"),o.EFF(16,"Direcci\xf3n:"),o.k0s(),o.EFF(17),o.k0s(),o.j41(18,"p")(19,"strong"),o.EFF(20,"Categor\xeda:"),o.k0s(),o.EFF(21),o.k0s(),o.j41(22,"p")(23,"strong"),o.EFF(24,"Descripci\xf3n:"),o.k0s()(),o.j41(25,"p"),o.EFF(26),o.k0s(),o.DNE(27,b,4,1,"p",7),o.k0s()(),o.j41(28,"ion-button",8),o.bIt("click",function(){o.eBV(n);const t=o.XpG();return o.Njj(t.agregarAlCarrito())}),o.EFF(29," Agregar al carrito "),o.k0s(),o.j41(30,"ion-button",9),o.bIt("click",function(){o.eBV(n);const t=o.XpG();return o.Njj(t.comprarAhora())}),o.EFF(31," Comprar ahora "),o.k0s(),o.j41(32,"ion-button",10),o.bIt("click",function(){o.eBV(n);const t=o.XpG();return o.Njj(t.abrirEnGoogleMaps())}),o.EFF(33," Ver direcci\xf3n en Google Maps "),o.k0s(),o.j41(34,"ion-button",11),o.bIt("click",function(){o.eBV(n);const t=o.XpG();return o.Njj(t.contactarVendedor())}),o.EFF(35," Contactar por WhatsApp "),o.k0s(),o.bVm()}if(2&e){const n=o.XpG();o.R7$(2),o.Y8G("src",n.imagenProducto,o.B4B),o.R7$(4),o.JRh(n.producto.nombre),o.R7$(2),o.SpI("Precio: $",n.producto.precio,""),o.R7$(5),o.SpI(" ",n.producto.vendedor.nombre,""),o.R7$(4),o.SpI(" ",n.producto.vendedor.direccion||"No disponible",""),o.R7$(4),o.SpI(" ",n.producto.categoria||"No especificada",""),o.R7$(5),o.JRh(n.producto.descripcion||"Este producto no tiene una descripci\xf3n."),o.R7$(),o.Y8G("ngIf",n.producto.infoExtra)}}function j(e,l){1&e&&(o.nrm(0,"ion-spinner",12),o.j41(1,"p",13),o.EFF(2,"Cargando producto..."),o.k0s())}const _=[{path:"",component:(()=>{var e;class l{constructor(r,t,a,i,d){this.route=r,this.http=t,this.authService=a,this.alertCtrl=i,this.navCtrl=d,this.producto=null,this.loading=!0,this.esVendedor=!1}ngOnInit(){this.route.paramMap.subscribe(r=>{const t=r.get("id");t?this.cargarProducto(t):(console.warn("No se recibi\xf3 id del producto"),this.loading=!1,this.mostrarAlerta("Error","No se encontr\xf3 el producto solicitado"),this.navCtrl.navigateBack("/hub"))})}cargarProducto(r){var t=this;return(0,u.A)(function*(){try{const a=yield t.authService.getToken();if(!a)return t.mostrarAlerta("Sesi\xf3n requerida","Debes iniciar sesi\xf3n para ver este producto"),void t.navCtrl.navigateBack("/login");const i=new p.Lr({Authorization:`Bearer ${a}`}),d=yield t.http.get(`${g.c.apiUrl}/api/mercado/${r}`,{headers:i}).toPromise();if(!d)throw new Error("Producto no encontrado");t.producto=d,console.log("Producto recibido del backend:",d),t.esVendedor=yield t.verificarSiEsVendedor(d.vendedor.correo),t.loading=!1}catch(a){console.error("Error cargando producto:",a),t.loading=!1,t.mostrarAlerta("Error","No se pudo cargar el producto"),t.navCtrl.navigateBack("/hub")}})()}get imagenProducto(){var r;return this.producto?(null===(r=this.producto.imagenUrl)||void 0===r?void 0:r.trim())||(this.producto.usaImagenGlobal?`${g.c.apiUrl}/api/productos/${this.producto.codigo}/imagen`:"assets/images/producto-placeholder.png"):"assets/images/producto-placeholder.png"}verificarSiEsVendedor(r){var t=this;return(0,u.A)(function*(){const a=yield t.authService.getUser();return(null==a?void 0:a.email)===r})()}agregarAlCarrito(){var r=this;return(0,u.A)(function*(){if(r.producto)try{const i=yield r.authService.getToken();if(!i)return r.mostrarAlerta("No autenticado","Debes iniciar sesi\xf3n para agregar productos al carrito."),void r.navCtrl.navigateForward("/login");if(r.esVendedor)return void r.mostrarAlerta("Acci\xf3n no permitida","No puedes agregar tus propios productos al carrito.");const d=new p.Lr({Authorization:`Bearer ${i}`,"Content-Type":"application/json"}),y={productoId:r.producto.codigo,cantidad:1};yield r.http.post(`${g.c.apiUrl}/api/carrito`,y,{headers:d}).toPromise(),r.mostrarAlerta("\xc9xito",`"${r.producto.nombre}" agregado al carrito.`)}catch(i){var t,a;console.error("Error agregando al carrito:",i);let d="No se pudo agregar el producto al carrito.";null!==(t=i.error)&&void 0!==t&&t.error?d=i.error.error:null!==(a=i.error)&&void 0!==a&&a.mensaje&&(d=i.error.mensaje),r.mostrarAlerta("Error",d)}else r.mostrarAlerta("Error","No hay producto para agregar al carrito.")})()}comprarAhora(){this.producto&&(console.log("Compra iniciada para:",this.producto),this.mostrarAlerta("Funci\xf3n en desarrollo","La compra directa estar\xe1 disponible pronto."))}abrirEnGoogleMaps(){var r;if(null===(r=this.producto)||void 0===r||null===(r=r.vendedor)||void 0===r||!r.direccion)return void this.mostrarAlerta("Informaci\xf3n","No hay direcci\xf3n disponible para este vendedor.");const a=`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(this.producto.vendedor.direccion)}`;window.open(a,"_blank")}contactarVendedor(){var r;if(null===(r=this.producto)||void 0===r||null===(r=r.vendedor)||void 0===r||!r.telefono)return void this.mostrarAlerta("Informaci\xf3n","No hay tel\xe9fono disponible para este vendedor.");const t=this.producto.vendedor.telefono.replace(/\D/g,"");window.open(`https://wa.me/52${t}`,"_blank")}mostrarAlerta(r,t){var a=this;return(0,u.A)(function*(){yield(yield a.alertCtrl.create({header:r,message:t,buttons:["OK"]})).present()})()}volver(){this.navCtrl.navigateBack("/hub")}}return(e=l).\u0275fac=function(r){return new(r||e)(o.rXU(P.nX),o.rXU(p.Qq),o.rXU(F.u),o.rXU(s.hG),o.rXU(k.q9))},e.\u0275cmp=o.VBU({type:e,selectors:[["app-producto"]],standalone:!1,decls:10,vars:4,consts:[["cargando",""],[3,"translucent"],["expand","block","color","medium","slot","start",3,"click"],[1,"ion-padding",3,"fullscreen"],[4,"ngIf","ngIfElse"],[1,"ion-text-center",2,"margin-bottom","16px"],["alt","Producto",2,"width","200px","height","200px","object-fit","cover","border-radius","8px",3,"src"],[4,"ngIf"],["expand","block","color","success",3,"click"],["expand","block","color","primary",3,"click"],["expand","block","color","tertiary",3,"click"],["expand","block","color","medium",3,"click"],["name","crescent",1,"ion-margin-top"],[1,"ion-text-center","ion-margin-top"]],template:function(r,t){if(1&r){const a=o.RV6();o.j41(0,"ion-header",1)(1,"ion-toolbar")(2,"ion-button",2),o.bIt("click",function(){return o.eBV(a),o.Njj(t.volver())}),o.EFF(3," Atr\xe1s "),o.k0s(),o.j41(4,"ion-title"),o.EFF(5,"Detalles del Producto"),o.k0s()()(),o.j41(6,"ion-content",3),o.DNE(7,E,36,8,"ng-container",4)(8,j,3,0,"ng-template",null,0,o.C5r),o.k0s()}if(2&r){const a=o.sdS(9);o.Y8G("translucent",!0),o.R7$(6),o.Y8G("fullscreen",!0),o.R7$(),o.Y8G("ngIf",!t.loading&&t.producto)("ngIfElse",a)}},dependencies:[h.bT,s.Jm,s.b_,s.I9,s.ME,s.HW,s.tN,s.W9,s.eU,s.w2,s.BC,s.ai],encapsulation:2}),l})()}];let A=(()=>{var e;class l{}return(e=l).\u0275fac=function(r){return new(r||e)},e.\u0275mod=o.$C({type:e}),e.\u0275inj=o.G2t({imports:[v.iI.forChild(_),v.iI]}),l})(),I=(()=>{var e;class l{}return(e=l).\u0275fac=function(r){return new(r||e)},e.\u0275mod=o.$C({type:e}),e.\u0275inj=o.G2t({imports:[h.MD,f.YN,s.bv,A]}),l})()}}]);